
<!DOCTYPE html>
<html data-wf-page="601c049ad82b2e1c184dbcae" data-wf-site="601c049a7d7f2b0e4f241841">
<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="style.css">
<link href="css/normalize.css" rel="stylesheet" type="text/css"> 
<link href="css/webflow.css" rel="stylesheet" type="text/css">
  <link href="css/miami-dda-office-report.webflow.css" rel="stylesheet" type="text/css">
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">
    <link href='css/dda.css' rel='stylesheet' />
<script src="https://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-format.v2.min.js"></script>
<script src="https://d3js.org/d3-geo.v1.min.js"></script>
<script src="https://clynekp.github.io/d3-tip.min.js"></script>
<script src="https://d3js.org/d3-scale.v3.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/d3-annotation/1.12.1/d3-annotation.min.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css" />
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
<script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet" />

<title>Miami DDA Office Report</title>
<script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
<script type="text/javascript">WebFont.load({  google: {    families: ["Varela Round:400","Cabin:regular,500,500italic,600,600italic,700"]  }});</script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic"]  }});</script>
<!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
<script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
<style>

body{
  margin: 0px auto;
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
}

h1{
  margin: 50px;
}

h1{
  text-align: center;
}

p{
  z-index:500;
  text-align: center
}

.tick line{
  visibility:hidden;
}

.axis text{ 
  font: 14px Nunito;
  font-weight: bold;
  fill: #b1b1b1;}

  .axis path{ 
  stroke: #b1b1b1;}

#container{
  position: relative;
}

#sections{
    width: auto;
    position: relative;
    margin: 0px auto;
    margin-left: 60vw;
    margin-right: 10vw;    
}



#sections > div{
    padding: 10px;
    margin-bottom: 80vh;
    opacity: .5;
}

#sections p{
  background: rgba(255,255,255,.5);
  padding:2em;
}
#sections > div:last-child{
  margin-bottom: 30px;
}
#sections > div.graph-scroll-active{
  opacity: 1;
}

#graph{
  width: 100%;
  position: -webkit-sticky;
  position: sticky;
  top: 0px;
}

#map {
  height: 75vh;
  width: 100%;
  position: -webkit-sticky;
  position: sticky;
  top: 100px;
}

  #menu{
    margin:10px;
  }

.container-2 p{
  background: rgb(255 255 255 / 88%) !important;
}

/*.container-2 #sections{
  margin-left: 30% !important
}
*/

@media screen and (max-width: 925px)  {
  #graph{
    width: 100%;
    margin-left: 0px;
    float: none;
  }

   #menu {
        background: white;
        font-family: 'Nunito', sans-serif;
        font-size: 15px;
        position: absolute;
        z-index: 1;
        top: 20px;
        left: 20px;
        right: 20px;
        width: 10vw;
        display: inline-block;
        color: #fff;
        box-shadow: 1.5px 1.5px 2px rgba(0, 0, 0, 0.2);
        -moz-box-shadow: 1.5px 1.5px 2px rgba(0, 0, 0, 0.2);
        -webkit-box-shadow: 1.5px 1.5px 2px rgba(0, 0, 0, 0.2)
      }

  #sections{
    width: auto;
    position: relative;
    margin: 0px auto;
  }

  #sections > div{
    background: rgba(255,255,255,.5);
    padding: 10px;
    border-top: 1px solid;
    border-bottom: 1px solid;
    margin-bottom: 80vh;
  }



  pre{
    overflow: hidden;
  }

  h1{
    margin: 10px;
  }
}

  .on {
        background: white url("../style/check1.svg") no-repeat right;
        background-origin: content-box;
        background-size: 18px 18px;
        display: block;
        margin: 0px;
        position: relative;
        z-index:200;
        width: 10vw;
        padding: 10px;
        color: black;
        border-bottom: 1px solid #8D9192;
    }
.bordertop{border-top: 1px solid #8D9192;}
    .on:hover {
        background: #51b3c9 url("../style/check1hover.svg") no-repeat right;
        background-origin: content-box;
        background-size: 18px 18px;
        color: white;
    }
    .off {
        background: white url("../style/check3.svg") no-repeat right;
        background-origin: content-box;
        background-size: 18px 18px;
        color: black;
        display: block;
        margin: 0;
        padding: 0;
        padding: 10px;
        border-bottom: 1px solid #8D9192;
    }
    .off:hover {
        background: #51b3c9 url("../style/check3hover.svg") no-repeat right;
        background-origin: content-box;
        background-size: 18px 18px;
        color: white;
    }
    .legend {
        padding: 10px;
        background: #fff;
        color: #C7354D;
        vertical-align:middle;
    }
    .row {
        display: table-row;
    }
    .noborder {
        border-bottom: 0px solid white;
    }

circle{
  fill: steelblue;
}

.mono{
  font-family: monospace;
}



</style>
</head>
<body>
  <div class="section cc-store-home-wrap">
    <div class="intro-header">
      <div class="intro-content cc-homepage">
        <div class="intro-text">
          <div class="heading-jumbo">DOWNTOWN MIAMI</div>
          <div class="paragraph-bigger cc-bigger-white-light"><span class="text-span">ANNUAL OFFICE MARKET OVERVIEW</span><br></div>
        </div>
      </div>
    </div>
    <div class="container">
      <div class="motto-wrap">
        <div class="label cc-light">INTRODUCTION</div>
        <div class="heading-jumbo-small">While office markets across the country continue to feel the impact of the COVID-19 pandemic, early indicators suggest greater resilience in the Downtown Miami market. Asking rates not only remain stable, but have increased for Class A office spaces, while vacancy has only risen slightly compared to other markets. More importantly, the flurry of activity in the last few months of 2020 is a testament to Miami’s rising position as an attractive, world-class location for businesses and corporates, especially new-to-market players.

Downtown Miami is arguable even better situated – its thriving restaurant scene, top-quality hotels, transit access, and upcoming state-of-the-art office buildings, will continue to make it a desirable market for tenants looking to relocate or expand in Miami, as well as young talent seeking job opportunities.
<br></div>
      </div>
      <div class="divider"></div>
      <div class="home-content-wrap">
        <div class="div-block">
          <div data-collapse="small" data-animation="default" data-duration="400" role="banner" class="navbar-2 w-nav">
            <div class="container-13 w-container">
              <nav role="navigation" class="nav-menu-2 w-nav-menu">
                <a href="#Office-Market" class="nav-link-3-copy w-nav-link">OFFICE MARKET</a>
                <div class="div-block-27"></div>
                <a href="#District-Profiles" class="nav-link-3 w-nav-link">DISTRICT PROFILES</a>
                <div class="div-block-27"></div>
                <a href="#Employment" class="nav-link-5 w-nav-link">TALENT</a>
              </nav>
              <div class="menu-button-3 w-nav-button">
                <div class="w-icon-nav-menu"></div>
              </div>
            </div>
          </div>
          <div class="div-block-26"></div>
        </div>
        <div id="Office-Market" class="section-5">
          <div class="section-heading w-container">
            <div class="icon"><img src="images/Office-Market.png" loading="lazy" width="75" alt=""></div>
            <h2 class="heading-2">KEY MARKET STATISTICS</h2>
          
            </div>
          </div>
<div id='container' class='container-1'>
  <div id='graph' class ="tab04">
    <div class="tab04_container">
              <div data-duration-in="300" data-duration-out="100" data-easing="ease-out" class="tab04_tabs w-tabs" style="border:none">
                <div class="tab04_content w-tab-content" id="contentpane">
                  <svg data-w-tab="Tab 1" class="tab04_pane w-tab-pane w--tab-active" id="rentvis"></svg>
                  <svg data-w-tab="Tab 3" class="tab04_pane w-tab-pane" id="vacancyvis"></svg>
                  <svg data-w-tab="Tab 4" class="tab04_pane w-tab-pane" id= "absorbvis"></svg>
                </div>
                   <div class="tab04_menu w-tab-menu" style="width:100vw; background-color: #FFFFFF">
                  <a data-w-tab="Tab 1" class="tab04_tab w-inline-block w-tab-link w--current" id="both" style="display:none !important">
                    
                  </a>
                  <a data-w-tab="Tab 3" class="tab04_tab w-inline-block w-tab-link" id="vacancy" style="display:none !important">
                  </a>
                  <a data-w-tab="Tab 4" class="tab04_tab w-inline-block w-tab-link" id="absorption" style="display:none !important">
                  </a>
                </div>
              </div>
            </div>
  </div>
  <div id='sections'>
    <div>
    </div>

    <div>
     <p>Rents have remained stable in Downtown Miami despite slower absorption and higher vacancy.</p>
    </div>


    <div>
      <p>Class A office rents have buoyed the overall figure, demonstrating continuing demand for high-caliber workplaces compared to other major markets which saw sharp decreases following the beginning of the COVID-19 pandemic.</p>
    </div>

    <div>
      <p>Downtown Miami's vacancy rate has increased as a result of COVID, reversing a recent downward trend.</p>
    </div>

    <div>
      <p>However, the overal vacancy impact on Downtown Miami has been limited compared to other major markets.</p>
    </div>

    <div>
      <p>While early 2020 saw weak absorption, a recent uptick in lease deals in Q4 are quickly reversing those trends. Developers and brokers are seeing increasing new-to-market activity and expect to see that reflected in vacancy and absorption data by mid-year 2021.
      </p>
    </div>

        <div>
    </div>

  </div>

</div>

<h1>
  
</h1>

<div id='container' class='container-2'>
  <div id='map'>
    <div id='menu' class='mobilehide'>
      <div id='classabutton' class='on bordertop'>Office</div>
      <div id='otherbutton' class='on'>Residential</div>
      <div id='condobutton' class='on'>Transit</div>
  </div>
  </div>

  <div id='sections'>
    <div>
           <p>Downtown Miami is host to a unique array of neighborhoods including the Central Business District, Brickell, and Arts & Entertainment District.
      </p>
    </div>
    <div>
      <p>The DDA Area has over 23 million square feet of office inventory.
      </p>
    </div>
    <div>
            <p>There is currently 1.5M SF of office development in the pipeline, including 830 Brickell, a standalone Class A-plus office tower adding 640,000 SF in the heart of Brickell.
      </p>
    </div>
    <div>
      <p> Downtown's extensive public transportation network including Metrorail, MetroMover, Tri-Rail, and Brightline connect downtown to Greater Miami and South Florida, bringing in workers and visitors.
      </p>
     </div> 
    <div>
    </div>
  </div>


</div>

</div>
<div id="District-Profiles" class="section-4">
          <div class="div-block-36">
            <div class="icon"><img src="images/District.png" loading="lazy" width="61" alt=""></div>
            <h2 class="section-heading-copy-copy">DISTRICT PROFILES</h2>
            <p style="color:#FFF">Downtown Miami is host to a unique array of neighborhoods that each have their own character. Brickell is Miami’s financial hub, with a growing residential component supporting new restaurants, nightlife, and shopping destinations. Tourists are also electing to stay and
play in Brickell thanks to a host of hotels throughout the neighborhood. Just across the Miami River from Brickell, the Central Business
District (CBD) is the historic center of business, commerce and culture in Miami. The CBD is now evolving into a hub of startups and
modern companies, of restaurants and nightlife, and of the quintessential urban lifestyle. Miami DDA continues to lead the way as the largest downtown office market within Miami-Dade County and the state of Florida in terms
of rentable square footage, and Class A rental rates.</p><br>
            <div class="div-block-25">
              <a href="#" class="dbutton button-13 w-button" id="MiamiButton"><strong class="bold-text-10">MIAMI-DADE</strong></a>
              <a href="#" class="dbutton button-12 w-button" id="GDButton"><strong class="bold-text-11">GREATER DOWNTOWN</strong></a>
              <a href="#" class="dbutton button-12 w-button" id="DDAButton"><strong class="bold-text-12">DDA</strong></a>
              <a href="#" class="dbutton button-12 w-button" id="CBDButton"><strong class="bold-text-13">CBD</strong></a>
              <a href="#" class="dbutton button-12 w-button" id="AEButton"><strong class="bold-text-14">A&amp;E</strong></a>
              <a href="#" class="dbutton button-12 w-button" id="BrickellButton"><strong class="bold-text-14">BRICKELL</strong></a>
            </div>
            <div class="columns-2 w-row">
              <div class="column-13 w-col w-col-3">
                <div class="div-block-11" id="map2"></div>
              </div>
              <div class="w-col w-col-3">
                <div class="div-block-21">
                  <div><img src="images/Business.png" loading="lazy" width="129" alt="" class="image-4"></div>
                  <div class="div-block-22">
                    <div><strong class="bold-text-16">Businesses</strong></div>
                    <div class="div-block-35" id="businesses"></div>
                  </div>
                </div>
              </div>
              <div class="w-col w-col-3">
                <div class="div-block-21">
                  <div><img src="images/Population.png" loading="lazy" width="129" alt="" class="image-5"></div>
                  <div class="div-block-22">
                    <div><strong class="bold-text-17">Population</strong></div>
                    <div class="div-block-34" id="population"></div>
                  </div>
                </div>
              </div>
              <div class="w-col w-col-3">
                <div class="div-block-21">
                  <div><img src="images/Employee.png" loading="lazy" width="129" alt="" class="image-6"></div>
                  <div class="div-block-22">
                    <div><strong class="bold-text-18">Employees</strong></div>
                    <div class="div-block-33" id="employees"></div>
                  </div>
                </div>
              </div>
            </div>
            <div class="container-9 w-container">
              <div class="div-block-12" id="conditions"></div>
            </div>
          </div>
        </div>
       <div class="container-5 w-container">
            <div class="div-block-14">
              <h1 class="heading-3">Who&#x27;s Here?</h1>
              <p class="paragraph-2-copy">Downtown Miami’s diverse economy is reflected in the variety among its top employers including law, professional services, and tech companies. Many domestic and international firms are establishing regional offices in Miami and existing businesses are expanding to take advantage of a growing economy and trained workforce.</p>
              <div class="div-block-50" id="wrapper">
                      <div class="outer" id="emp">    
                        <div id="chart" class="inner"></div>
                      </div>
              </div>
            </div>
            <div class="div-block-14">
              <h1 class="heading-3">Who&#x27;s Coming?</h1>
              <p class="paragraph-2-copy">Leasing volumes were below historic levels in 2020 with a drop in activity in the Spring and Summer; however, trends have picked up recently with firms such as Shiftpixy using the COVID pandemic as an opportunity to relocate their business.</p>
              <div class="div-block-50" id="wrapper">
                <div class="outer" id="emp">    
                      <div id="chart2" class="inner"></div>
                </div>
              </div>
            </div>
          </div>
          <div class="div-block-38"></div>
          <div class="container-12 w-container">
            <h2 class="section-heading-copy">OFFICE EXPERIENCE</h2>
            <p class="paragraph-14">Conversations with major office tenants suggest a return to work plan:</p>
            <div class="div-block-7">[CONVERSATION GRAPHIC]</div>
            <h1 class="heading-9">The Shift to Quality</h1>
            <div class="w-row">
              <div class="column-7 w-col w-col-6 w-col-stack">
                <p class="paragraph-14">When workers return to the office, they’ll be heading to some of the most recent office stock in the country. Over the last 10 years, over a quarter of Miami’s office inventory has either been recently developed or has undergone major renovation such as buildings like 201 S Biscayne.</p>
                <div class="div-block-8">
                  <div class="div-block-37"><img src="images/201-S-Biscayne-Blvd-Miami-FL-201-S-Biscayne-Blvd-1-Large.jpg" loading="lazy" sizes="(max-width: 479px) 100vw, (max-width: 767px) 44vw, (max-width: 991px) 45vw, 23vw" srcset="images/201-S-Biscayne-Blvd-Miami-FL-201-S-Biscayne-Blvd-1-Large-p-500.jpeg 500w, images/201-S-Biscayne-Blvd-Miami-FL-201-S-Biscayne-Blvd-1-Large-p-800.jpeg 800w, images/201-S-Biscayne-Blvd-Miami-FL-201-S-Biscayne-Blvd-1-Large.jpg 883w" alt="" class="image-7"></div>
                  <div class="text-block-7"><span class="text-span-6">201 S Biscayne Blvd</span><span class="text-span-5"><br></span><br><span class="text-span-2">Year Built: </span>1983<br><span class="text-span-3">Year Renovated: </span>2020<br><span class="text-span-4">GSF:</span> 813K<br>‍</div>
                </div>
              </div>
              <div class="w-col w-col-6 w-col-stack">
                <div class="div-block-9"><iframe id="iframe" width=100% height = 100% src="inventory.html" frameborder="0" allowfullscreen scrolling="no"></iframe></div>
              </div>
            </div>
          </div>
          <div id="Employment" class="section-2">
          <div class="container-11 w-container">
            <div class="divider2"></div>
          </div>
          <div class="icon"><img src="images/Employment.png" loading="lazy" width="75" alt=""></div>
          <h2 class="heading">TALENT</h2>
          <p style="color:#000">Miami-Dade County is one of the most dynamic employment
markets in the nation with a year-over-year employment
growth averaging 3.76% in the last three years. Approximately
85,000 employees work in Downtown Miami which
represents 6.6% of the county’s workforce.</p><br>
          <div class="w-row">
            <div class="column-6 w-col w-col-3">
              <div class="div-block-17">
                <h1 class="heading-6">MIAMI DDA JOB GROWTH BETWEEN 2010-2020:<br></h1>
                <p class="paragraph-9">18%</p>
                <p class="paragraph-12">Professional Services, Government, and Finance &amp; Insurance make up 57% of total DDA jobs with Lawyers, Customer Service Reps, and Paralegals/ Legal Assistants as the top three occupations in 2020. In Greater Downtown, Computer Systems Design &amp; Related Services is the fastest growing industry, adding over one thousand jobs since 2010.</p>
              </div>
            </div>
            <div class="w-col w-col-9">
              <div class="div-block-26">
                  <a href="#" class="button-7 w-button" id="LargestInds" >Largest</a>
                  <a href="#" class="button-4 w-button" id="GrowingInds">Growing</a>
                  </div>
              <div class="div-block-13" id="top-industries"></div>
              <div class="div-block-26">
                  <a href="#" class="button-7 w-button" id="LargestInds" >Largest</a>
                  <a href="#" class="button-4 w-button" id="GrowingInds">Growing</a>
                  </div>
              <div class="div-block-13" id="top-occupations"></div>
            </div>
          </div>
          <div class="container-7 w-container">
            <h2 class="heading-7">Education</h2>
            <p class="paragraph-11">Education rates are increasing in Miami with 40K more secondary degree holders in 2019 than in 2010. As of 2019, Miami has a student population of 275K, making it the nation’s 6th largest college town with schools like the University of Miami, Florida International University, and Florida Atlantic producing a growing pipeline of talent. Miami talent likes to stay in Miami. As of 2019 65% of alumni from Miami schools stay in Miami after graduation. Miami also attracts a large share of graduates from throughout the state.</p>
            <div class="w-row">
              <div class="w-col w-col-6 w-col-stack">
                <div class="div-block-6"><svg id="educhart" width="100%" height="100%"></svg></div>
                <div class="range-wrap">
                      <input id="slide" type="range" class="range" min="2010" max="2019" value="2010">
                      <output class="bubble" style="left: calc(0% + 8px);top: 28px;"></output>
                  </div>
              </div>
              <div class="column-5 w-col w-col-6 w-col-stack">
                <p class="paragraph-12">TODAY:</p>
                <div class="columns-3 w-row">
                  <div class="w-col w-col-3">
                    <p class="paragraph-9-copy">18%</p>
                  </div>
                  <div class="w-col w-col-9">
                    <p>STUDENT POPULATION</p>
                  </div>
                </div>
                <div class="columns-4 w-row">
                  <div class="w-col w-col-3">
                    <p class="paragraph-9-copy">75%</p>
                  </div>
                  <div class="column-2 w-col w-col-9">
                    <p>OF POPULATION THAT SPEAKS A LANGUAGE OTHER THAN ENGLISH</p>
                  </div>
                </div>
                <p class="paragraph-13">BETWEEN 2010-2019:</p>
                <div class="columns-3 w-row">
                  <div class="w-col w-col-3">
                    <p class="paragraph-9-copy">40K+</p>
                  </div>
                  <div class="w-col w-col-8">
                    <p>BACHELOR &amp; ABOVE DEGREE HOLDERS</p>
                  </div>
                </div>
                <div class="columns-3 w-row">
                  <div class="w-col w-col-3">
                    <p class="paragraph-9">39%+</p>
                  </div>
                  <div class="w-col w-col-8">
                    <p>GROWTH IN BACHELOR &amp; ABOVE DEGREE HOLDERS</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="container-8 w-container">
            <h1 class="heading-7">Students</h1>
            <p class="paragraph-11">Miami currently has a student population of 275K, making Miami the nation’s 6th largest college town, with schools like the University of Miami, Florida International University, and Florida Atlantic producing a growing pipeline of talent. </p>
            <div class="div-block-7"><svg id="collegetowns" width="100%" height="100%"></div>
          </div>
          <div class="container-10 w-container">
            <h1 class="heading-7">Retention</h1>
            <p class="paragraph-11">Miami talent likes to stay in Miami. 65% of alumni from Miami schools stay in Miami after graduation. Miami also attracts a large share of graduates from throughout the state.</p>
            <div class="div-block-7" id="map3"></div>
            <!-- <h1 id="info"></h1> -->
            <p class="paragraph-14">Recent trends show influx of national talent into Miami. </p>
            <p class="paragraph-15">&quot;MIAMI STAKEHOLDER QUOTE&quot;<br>‍<br>- INTERVIEWEE</p>
            <div class="div-block-7"><iframe id="iframe" width=100% height = 100% src="https://flowmap.blue/1wiLanxSmo4W24N18dTczIu4vWA19AXL9yo1Vag5es9A/embed" frameborder="0" allowfullscreen></iframe></div>
          </div>
          <div class="container-10 w-container">
            <h1 class="heading-7">The Growing Buzz</h1>
            <p class="paragraph-11">As COVID has upended traditional ideas of the workplace and industries become less tied to specific geographies, many have been looking to relocate to areas with a higher quality of life and lower regulatory environment.</p>
            <div class="div-block-7"><div class='sk-ww-twitter-collection' data-embed-id='55161'></div><script src='https://www.sociablekit.com/app/embed/twitter-collections/widget.js' async defer></script></div>
          </div>
        </div>
        
      </div>
</div>
    </div>
  </div>
<script src="test/d3v4+jetpack.js"></script>
<script src="test/graph-scroll.js"></script>
<script>

var oldWidth = 0
function render(){
  if (oldWidth == innerWidth) return
  oldWidth = innerWidth

  var width = height = d3.select('#rentvis').node().offsetWidth
  var r = 40


  if (innerWidth <= 925){
    width = innerWidth
    height = innerHeight*.7
  }

  // return console.log(width, height)

let dataset, svg
let salarySizeScale, salaryXScale, categoryColorScale
let simulation, nodes
let categoryLegend, salaryLegend


//Read Data, convert numerical categories into floats
//Create the initial visualisation


d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=1356831804", function(d){
  return{
    location: d.location,
    class: d.class,
    year: +d.year,
    period: d.period,
    rent: +d.rent,
    vacancy: +d.vacancy,
    absorption: d.absorption,
  };
}, function(error, rows){
if (error) throw error;

  //  setTimeout(drawInitial(), 100)
//})


rows =  rows.filter(f => f.year >= 2015)

const colors = {'Miami':['#00b5cc'],'NY':['#eb529d'],'SF':['#eb529d'],'Chicago':['#eb529d']}

nested = d3.nest().key(function(d){return d.location}).entries(rows)
nestkeys = nested.map(function(d){return d.key;})



var vis = d3.select("#rentvis")
var margin = {top: 200, right: 50, bottom: 200, left: 60};
element = vis.node();
width = element.getBoundingClientRect().width - margin.left - margin.right,
height = element.getBoundingClientRect().height - margin.top - margin.bottom;

rentsvg = d3
  .select("#rentvis")
    .attr("width", width + margin.left + margin.right - 20)
    .attr("height", height + margin.top + margin.bottom)

    const rentchart = rentsvg
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

const rentgrp = rentchart
  .append("g")
  .attr("transform", `translate(-${margin.left},0)`);


rentgrp.append("text")
    .text("Gross Rent PSF")
    .attr("class","charttitle")
    .attr("x",-30)
    .attr("y",-30)
    .attr("transform", `translate(${margin.left},0)`)
    .attr("opacity",1)
    .attr("font-family", "Nunito")
    .attr("font-weight",700)
    .attr("font-size", "25")

// Create scales
const RentyScale = d3
  .scaleLinear()
  .range([height, 0])
  .domain([0, d3.max(rows, d => d.rent + 5)]);
const RentxScale = d3
  .scalePoint()
  .range([3, width-40])
  .domain(rows.map(function(d){ return d.period; }));

const Rentline = d3
  .line()
  .x(d => RentxScale(d.period))
  .y(d => RentyScale(d.rent))
  .curve(d3.curveBasis);


nestkeys.forEach(function(d){

    data =  rows.filter(f => f.location == d)
    
    console.log(colors[d][0])

    path = rentgrp
      .append("path")
      .attr("class",d + "_rentpath")
      .attr("d", Rentline(data))
      .attr("transform", `translate(${margin.left},0)`)
      .attr("fill", "none")
      .attr("stroke", colors[d][0])
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 5)

    pathLength = path.node().getTotalLength();

    path
  .attr("stroke-dashoffset", pathLength)
  .attr("stroke-dasharray", pathLength)


rentgrp.append("text")
    .text(d)
    .attr("class",d+"_rentlabel")
    .attr("x",RentxScale(d3.max(RentxScale.domain())) + 10)
    .attr("y",RentyScale(data[data.length-1 ].rent))
    .attr("transform", `translate(${margin.left},0)`)
    .attr("opacity",0)
    .attr("font-family", "Nunito")
    .style("fill", colors[d][0])
    .attr("font-weight",700)
    .attr("font-size", "20")

rentgrp.append("text")
    .text(d3.format("($.0f")(data[data.length-1 ].rent))
    .attr("class",d+"_rentlabelrent")
    .attr("x",RentxScale(d3.max(RentxScale.domain())) + 10)
    .attr("y",RentyScale(data[data.length-1 ].rent)+20)
    .attr("transform", `translate(${margin.left},0)`)
    .attr("opacity",0)
    .attr("font-family", "Nunito")
    .style("fill", colors[d][0])
    .attr("font-weight",700)
    .attr("font-size", "17")


})


// Add the X Axis
rentchart
  .append("g")
  .attr("class", "axis")
  .attr("transform", `translate(0,${height})`)
  .call(d3.axisBottom(RentxScale).tickSizeOuter(0)
.tickValues(RentxScale.domain().filter(function(d,i){ return !(i%4)})))
  .style('fill-opacity', d => d === 0 ? 0.0 : 1.0);
// Add the Y Axis
rentchart
  .append("g")
  .attr("class", "axis")
  .attr("transform", `translate(0, 0)`)
  .call(d3.axisLeft(RentyScale).tickSizeOuter(0)
    .tickFormat(d3.format("($.0f")));



/////VACANCY
vacancysvg = d3
  .select("#vacancyvis")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)

    const vacancychart = vacancysvg
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

const vacancygrp = vacancychart
  .append("g")
  .attr("transform", `translate(-${margin.left},0)`);

vacancygrp.append("text")
    .text("Vacancy Rate")
    .attr("class","charttitle")
    .attr("x",-30)
    .attr("y",-30)
    .attr("transform", `translate(${margin.left},0)`)
    .attr("opacity",1)
    .attr("font-family", "Nunito")
    .attr("font-weight",700)
    .attr("font-size", "25")

// Create scales
const vacancyyScale = d3
  .scaleLinear()
  .range([height, 0])
  .domain([0, d3.max(rows, d => d.vacancy + .02)]);
const vacancyxScale = d3
  .scalePoint()
  .range([3, width-40])
  .domain(rows.map(function(d){ return d.period; }));

const vacancyline = d3
  .line()
  .x(d => vacancyxScale(d.period))
  .y(d => vacancyyScale(d.vacancy))
  .curve(d3.curveBasis);

nestkeys.forEach(function(d){

    data =  rows.filter(f => f.location == d)
    
    path = vacancygrp
      .append("path")
      .attr("class",d + "_vacancypath")
      .attr("d", vacancyline(data))
      .attr("transform", `translate(${margin.left},0)`)
      .attr("fill", "none")
      .attr("stroke", colors[d][0])
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 5)

    pathLength = path.node().getTotalLength();

    path
  .attr("stroke-dashoffset", pathLength)
  .attr("stroke-dasharray", pathLength)

  vacancygrp.append("text")
    .text(d)
    .attr("class",d+"_vacancylabel")
    .attr("x",vacancyxScale(d3.max(vacancyxScale.domain())) + 5)
    .attr("y",vacancyyScale(data[data.length-1 ].vacancy))
    .attr("transform", `translate(${margin.left},0)`)
    .attr("font-family", "Nunito")
    .style("fill", colors[d][0])
    .attr("font-weight",700)
    .attr("font-size", "20")
    .attr("opacity",0)

    vacancygrp.append("text")
    .text(d3.format(".0%")(data[data.length-1 ].vacancy))
    .attr("class",d+"_vacancylabelvacancy")
    .attr("x",vacancyxScale(d3.max(vacancyxScale.domain())) + 10)
    .attr("y",vacancyyScale(data[data.length-1 ].vacancy)+20)
    .attr("transform", `translate(${margin.left},0)`)
    .attr("opacity",0)
    .attr("font-family", "Nunito")
    .style("fill", colors[d][0])
    .attr("font-weight",700)
    .attr("font-size", "17")
    .attr("opacity",0)


})

// Add the X Axis
vacancychart
  .append("g")
    .attr("class", "axis")
  .attr("transform", `translate(0,${height})`)
  .call(d3.axisBottom(vacancyxScale)
.tickValues(vacancyxScale.domain().filter(function(d,i){ return !(i%4)})));
// Add the Y Axis
vacancychart
  .append("g")
    .attr("class", "axis")
  .attr("transform", `translate(0, 0)`)
  .call(d3.axisLeft(vacancyyScale)
    .tickFormat(d3.format(".0%")));



//////Absorption
absvg = d3
  .select("#absorbvis")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)

    const abchart = absvg
    .append("g")
    .attr("transform", `translate(${margin.left},${margin.top})`);

const abgrp = abchart
  .append("g")
  .attr("transform", `translate(-${margin.left},0)`);

abgrp.append("text")
    .text("Net Absorption")
    .attr("class","charttitle")
    .attr("x",-30)
    .attr("y",-30)
    .attr("transform", `translate(${margin.left},0)`)
    .attr("opacity",1)
    .attr("font-family", "Nunito")
    .attr("font-weight",700)
    .attr("font-size", "25")

// Create scales
const abyScale = d3
  .scaleLinear()
  .range([height, 0])
  .domain([d3.min(rows, d => +d.absorption + .02), d3.max(rows, d => +d.absorption + .02)]);
const abxScale = d3
  .scalePoint()
  .range([3, width-40])
  .domain(rows.map(function(d){ return d.period; }));

const abline = d3
  .line()
  .x(d => abxScale(d.period))
  .y(d => abyScale(+d.absorption))
  .curve(d3.curveBasis);

nestkeys.forEach(function(d){

    data =  rows.filter(f => f.location == d)
    
  
    path = abgrp
      .append("path")
      .attr("class",d + "_abpath")
      .attr("d", abline(data))
      .attr("transform", `translate(${margin.left},0)`)
      .attr("fill", "none")
      .attr("stroke", colors[d][0])
      .attr("stroke-linejoin", "round")
      .attr("stroke-linecap", "round")
      .attr("stroke-width", 5)

    pathLength = path.node().getTotalLength();

    path
  .attr("stroke-dashoffset", pathLength)
  .attr("stroke-dasharray", pathLength)

  abgrp.append("text")
    .text(d)
    .attr("class",d+"_ablabel")
    .attr("x",abxScale(d3.max(abxScale.domain())) + 5)
    .attr("y",abyScale(+data[data.length-1 ].absorption))
    .attr("transform", `translate(${margin.left},0)`)
    .attr("opacity",0)
    .attr("font-family", "Nunito")
    .style("fill", colors[d][0])
    .attr("font-weight",700)
    .attr("font-size", "20")

  abgrp.append("text")
    .text(d3.format("(.0f")(data[data.length-1 ].absorption))
    .attr("class",d+"_ablabelab")
    .attr("x",abxScale(d3.max(abxScale.domain())) + 10)
    .attr("y",abyScale(data[data.length-1 ].absorption)+20)
    .attr("transform", `translate(${margin.left},0)`)
    .attr("opacity",0)
    .attr("font-family", "Nunito")
    .style("fill", colors[d][0])
    .attr("font-weight",700)
    .attr("font-size", "17")


})

// Add the X Axis
abchart
  .append("g")
    .attr("class", "axis")
  .attr("transform", `translate(0,${height})`)
  .call(d3.axisBottom(abxScale)
.tickValues(abxScale.domain().filter(function(d,i){ return !(i%4)})));
// Add the Y Axis
abchart
  .append("g")
    .attr("class", "axis")
  .attr("transform", `translate(0, 0)`)
  .call(d3.axisLeft(abyScale));


d3.selectAll(".tick")
    .filter(function (d) { return d === 0;  })
    .remove();


/*
////Annotations
const annotations = [
        {
          note: { 
            title: "COVID-19", 
            lineType: "none", 
            align: "middle",
            wrap: 150 //custom text wrapping
          },
          subject: {
            height: height,
            width: RentxScale(RentxScale.domain()[43]) - RentxScale(RentxScale.domain()[41])
          },
          type: d3.annotationCalloutRect,
          y: 1,
          disable: ["connector"], // doesn't draw the connector
          //can pass "subject" "note" and "connector" as valid options
          dx: (RentxScale(RentxScale.domain()[43]) - RentxScale(RentxScale.domain()[41]))/2,
          data: { x: RentxScale.domain()[41]}
        }]


const type = d3.annotationCustomType(
        d3.annotationBadge, 
        {"subject":{"radius": 10 }}
      )

const makeAnnotations = d3.annotation()
        .type(type)
        .accessors({ 
          x: function(d){ return RentxScale(d.x)},
          y: function(d){ return RentyScale(d.y) }
        })
        .annotations(annotations)

      rentchart
        .append("g")
        .attr("class", "annotation-group")
        .call(makeAnnotations)



const vacannotations = [
        {
          note: { 
            title: "COVID-19", 
            lineType: "none", 
            align: "middle",
            wrap: 150 //custom text wrapping
          },
          subject: {
            height: height,
            width: vacancyxScale(vacancyxScale.domain()[43]) - vacancyxScale(vacancyxScale.domain()[41])
          },
          type: d3.annotationCalloutRect,
          y: 1,
          disable: ["connector"], // doesn't draw the connector
          //can pass "subject" "note" and "connector" as valid options
          dx: (vacancyxScale(vacancyxScale.domain()[43]) - vacancyxScale(vacancyxScale.domain()[41]))/2,
          data: { x: vacancyxScale.domain()[41]}
        }]


const makevacAnnotations = d3.annotation()
        .type(type)
        .accessors({ 
          x: function(d){ return vacancyxScale(d.x)},
          y: function(d){ return vacancyScale(d.y) }
        })
        .annotations(vacannotations)

      vacancychart
        .append("g")
        .attr("class", "annotation-group")
        .call(makevacAnnotations)

const abannotations = [
        {
          note: { 
            title: "COVID-19", 
            lineType: "none", 
            align: "middle",
            wrap: 150 //custom text wrapping
          },
          subject: {
            height: height,
            width: abxScale(abxScale.domain()[43]) - abxScale(abxScale.domain()[41])
          },
          type: d3.annotationCalloutRect,
          y: 1,
          disable: ["connector"], // doesn't draw the connector
          //can pass "subject" "note" and "connector" as valid options
          dx: (abxScale(abxScale.domain()[43]) - abxScale(abxScale.domain()[41]))/2,
          data: { x: abxScale.domain()[41]}
        }]


const makeabAnnotations = d3.annotation()
        .type(type)
        .accessors({ 
          x: function(d){ return abxScale(d.x)},
          y: function(d){ return abScale(d.y) }
        })
        .annotations(abannotations)

      abchart
        .append("g")
        .attr("class", "annotation-group")
        .call(makeabAnnotations)
*/
// Tooltip

/*
var bisect = d3.bisector(function(d) { return d.period; }).left;

var tooltip = d3.select(".tab04_content.w-tab-content").append("div")
    .attr("class", "tooltip")
    .style("display", "none");

var focus = rentgrp.append("g")
            .attr("class", "focus")
            .style("display", "none");

focus.append("circle")
    .attr("r", 5);

var tooltipDate = tooltip.append("div")
    .attr("class", "tooltip-date");

var tooltipLikes = tooltip.append("div");
tooltipLikes.append("span")
    .attr("class", "tooltip-title")
    .text("Gross Rent PSF: ");

var tooltipLikesValue = tooltipLikes.append("span")
    .attr("class", "tooltip-likes");

rentchart.append("rect")
    .attr("class", "ttoverlay")
    .attr("width", width)
    .attr("height", height)
    .on("mouseover", function() { focus.style("display", null); tooltip.style("display", null);  })
    .on("mouseout", function() { focus.style("display", "none"); tooltip.style("display", "none"); })
    .on("mousemove", mousemove);

function mousemove() {
    var xPos = d3.mouse(this)[0];
    var domain = RentxScale.domain();
    var range = RentxScale.range();
    var rangePoints = d3.range(range[0], range[1], RentxScale.step());

    var x0 = domain[d3.bisect(rangePoints, xPos) ];
        i = bisect(rows, x0, 0),
        d0 = rows[i - 1],
        d1 = rows[i],
        d = x0 - d0.period > d1.period - x0 ? d1 : d0;
    focus.attr("transform", "translate(" + (RentxScale(d.period) + margin.left) + "," + RentyScale(d.rent) + ")");
    tooltip.attr("style", "left:" + (RentxScale(d.period) + 64) + "px;top:" + RentyScale(d.rent) + "px;");
    tooltip.select(".tooltip-date").text(d.period);
    tooltip.select(".tooltip-likes").text(d3.format("($.2f")(d.rent));

}
*/

});




function draw1(){

}
function draw2(){
d3.select(".Miami_rentpath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);

d3.select(".Miami_rentlabel")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".Miami_rentlabelrent")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);


}

function draw3(){

d3.select(".NY_rentpath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);

d3.select(".Chicago_rentpath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);

d3.select(".SF_rentpath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);

d3.select(".NY_rentlabel")
    .transition()
      .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".SF_rentlabel")
    .transition()
      .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".Chicago_rentlabel")
    .transition()
      .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".NY_rentlabelrent")
    .transition()
      .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".SF_rentlabelrent")
    .transition()
      .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".Chicago_rentlabelrent")
    .transition()
      .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);


}

function draw4(){

document.getElementById('vacancy').click();

d3.select(".Miami_vacancypath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);

d3.select(".Miami_vacancylabel")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".Miami_vacancylabelvacancy")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

}



function draw5(){
 
d3.select(".NY_vacancypath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);

d3.select(".Chicago_vacancypath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);

d3.select(".SF_vacancypath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);


d3.select(".NY_vacancylabel")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);
d3.select(".Chicago_vacancylabel")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".SF_vacancylabel")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".NY_vacancylabelvacancy")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);
d3.select(".Chicago_vacancylabelvacancy")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".SF_vacancylabelvacancy")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

}

function draw6(){
document.getElementById('absorption').click();

d3.select(".Miami_abpath")
    .transition()
  .ease(d3.easeSin)
  .duration(5000)
  .attr("stroke-dashoffset", 0);

d3.select(".Miami_ablabel")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

d3.select(".Miami_ablabelab")
    .transition()
    .delay(4000)
  .duration(500)
  .attr("opacity", 1);

}

function draw7(){
  return
}    

      let functions = [
        draw1,
    draw2,
    draw3,
    draw4,
    draw5, 
    draw6,
    draw7]

  var gs = d3.graphScroll()
      .container(d3.select('.container-1'))
      .graph(d3.selectAll('container-1 #graph'))
      .eventId('uniqueId1')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-1 #sections > div'))
      // .offset(innerWidth < 900 ? innerHeight - 30 : 200)
      .on('active', function(i){
        functions[i]()
      })

//MAP

mapboxgl.accessToken = 'pk.eyJ1Ijoia3BjbHluZSIsImEiOiJjanN3MzlpY2EwZGpjM3lsaGNhb3NqY3JmIn0._sGjIhmL5Xt08WIMWRsSsg';
        var bounds = [
[-80.24975, 25.73521]
, [-80.13341, 25.83169]
];
r
        const w = 255 * 0.65;

        const defaultMaxPitch = 89.9;

        var map = new mapboxgl.Map({
            container: 'map'
            , style: 'mapbox://styles/kpclyne/ckm2x7n0u1cr018nzpjesupiy'
            , center: [-80.188965, 25.776679]
            , zoom: 13
            , pitch: 0
            , bearing: 0
            , maxPitch: 85,
        }); 

     

        map.scrollZoom.disable();

        /*map.addControl(new MapboxGeocoder({
            accessToken: mapboxgl.accessToken
            , mapboxgl: mapboxgl
        }));*/

        var bins = 16;
        var maxHeight = 265;
        var binWidth = maxHeight / bins;

        map.on('load', function () {
            map.addSource('floorplan', {
          // GeoJSON Data source used in vector tiles, documented at
          // https://gist.github.com/ryanbaumann/a7d970386ce59d11c16278b90dde094d
          'type': 'geojson',
          'data':'miami3d.geojson'

          });

          map.addSource('underconstruction', {
          // GeoJSON Data source used in vector tiles, documented at
          // https://gist.github.com/ryanbaumann/a7d970386ce59d11c16278b90dde094d
          'type': 'geojson',
          'data':'gis/830Brickell.geojson'
          });
           
          for (var i = 0; i < bins; i++) {
          map.addLayer({
          'id': 'room-extrusion' + i,
          'type': 'fill-extrusion',
          'source': 'floorplan',
          'filter': 
          ['all',
          ['>', 'height', i*binWidth],
          ['<=', 'height', (i + 1) * binWidth]],
          'paint': {
          // See the Mapbox Style Specification for details on data expressions.
          // https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions
           
          // Get the fill-extrusion-color from the source 'color' property.
          'fill-extrusion-color': "#314CCD",
           
          // Get fill-extrusion-height from the source 'height' property.
          'fill-extrusion-height': 0,
           
          // Get fill-extrusion-base from the source 'base_height' property.
          'fill-extrusion-base': ['get', 'minHeight'],
          //Set the 
          'fill-extrusion-height-transition':{
                    duration: 2000,
                    delay: 3000
                },
          // Make extrusions slightly opaque for see through indoor walls.
          'fill-extrusion-opacity': 0
          }
          });}
        
        map.addLayer({
'id': 'under-construction',
'type': 'fill-extrusion',
'source': 'underconstruction',
'paint': {
// See the Mapbox Style Specification for details on data expressions.
// https://docs.mapbox.com/mapbox-gl-js/style-spec/#expressions
 
// Get the fill-extrusion-color from the source 'color' property.
'fill-extrusion-color': "#314CCD",
 
// Get fill-extrusion-height from the source 'height' property.
'fill-extrusion-height': 0,
 
// Get fill-extrusion-base from the source 'base_height' property.
'fill-extrusion-base': ['get', 'minheight'],
//Set the 
'fill-extrusion-height-transition':{
          duration: 2000,
          delay: 2000
      },
// Make extrusions slightly opaque for see through indoor walls.
'fill-extrusion-opacity': .9
}
})
    }); 
        
/*
        // set functions for layer toggle buttons
        map.on('load', function () {
            var classatoggle = document.getElementById('classabutton');
            classatoggle.addEventListener('click', function () {
                if (classatoggle.className === 'on bordertop') {
                    classatoggle.setAttribute('class', 'off');
                    map.setLayoutProperty('office', 'visibility', 'none');
                    map.setLayoutProperty('office', 'visibility', 'none');
                    classatoggle.className = 'off bordertop';
                }
                else {
                    classatoggle.setAttribute('class', 'on bordertop');
                    map.setLayoutProperty('office', 'visibility', 'visible');
                    map.setLayoutProperty('office', 'visibility', 'visible');
                    classatoggle.className = 'on bordertop';
                }
            });
        });
        map.on('load', function () {
            var othertoggle = document.getElementById('otherbutton');
            othertoggle.addEventListener('click', function () {
                if (othertoggle.className === 'on') {
                    othertoggle.setAttribute('class', 'off');
                    map.setLayoutProperty('resi', 'visibility', 'none');
                    map.setLayoutProperty('resi', 'visibility', 'none');
                    othertoggle.className = 'off';
                }
                else {
                    othertoggle.setAttribute('class', 'on bordertop');
                    map.setLayoutProperty('resi', 'visibility', 'visible');
                    map.setLayoutProperty('resi', 'visibility', 'visible');
                    othertoggle.className = 'on';
                }
            });
        });
        map.on('load', function () {
            var condotoggle = document.getElementById('condobutton');
            condotoggle.addEventListener('click', function () {
                if (condotoggle.className === 'on') {
                    condotoggle.setAttribute('class', 'off');
                    map.setLayoutProperty('metrorail', 'visibility', 'none');
                    map.setLayoutProperty('metrorail', 'visibility', 'none');
                    condotoggle.className = 'off';
                }
                else {
                    condotoggle.setAttribute('class', 'on bordertop');
                    map.setLayoutProperty('metrorail', 'visibility', 'visible');
                    map.setLayoutProperty('metrorail', 'visibility', 'visible');
                    condotoggle.className = 'on';
                }
            });
        });


    
        // callouts on click
        map.on('load', function () {
            map.on('click', 'office', function (e) {
                new mapboxgl.Popup().setLngLat(e.lngLat).setHTML('<div class="marker-title">' + e.features[0].properties.name + '</div><!--<div style = "padding-top:5px;"> Type: <b>' + e.features[0].properties.type + '</b></div>-->').setMaxWidth("700px").addTo(map);
            });
            map.on('mouseenter', 'office', function () {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'office', function () {
                map.getCanvas().style.cursor = '';
            });
        });
        map.on('load', function () {
            map.on('click', 'resi', function (e) {
                new mapboxgl.Popup().setLngLat(e.lngLat).setHTML('<div class="marker-title">' + e.features[0].properties.name + '</div>').setMaxWidth("700px").addTo(map);
            });
            map.on('mouseenter', 'resi', function () {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'resi', function () {
                map.getCanvas().style.cursor = '';
            });
        });
        map.on('load', function () {
            map.on('click', 'metro', function (e) {
                new mapboxgl.Popup().setLngLat(e.lngLat).setHTML('<div class="marker-title">' + e.features[0].properties.Name + '</div><div style = "padding-top:5px;"> Stories: <b>' + e.features[0].properties.stories + '</b></div><div> Units: <b>' + e.features[0].properties.units + '</b></div><div> Property Mgmt Co: <b>' + e.features[0].properties.info + '</b></div>').setMaxWidth("700px").addTo(map);
            });
            map.on('mouseenter', 'metro', function () {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'metro', function () {
                map.getCanvas().style.cursor = '';
            });
        });
        map.on('load', function () {
            map.on('click', 'rental', function (e) {
                new mapboxgl.Popup().setLngLat(e.lngLat).setHTML('<div class="marker-title">' + e.features[0].properties.Name + '</div><div style = "padding-top:5px;"> Stories: <b>' + e.features[0].properties.stories + '</b></div><div> Units: <b>' + e.features[0].properties.units + '</b></div><div> <b><a href="' + e.features[0].properties.info + '" target="_blank">Website</a> </b></div>').setMaxWidth("700px").addTo(map);
            });
            map.on('mouseenter', 'rental', function () {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'rental', function () {
                map.getCanvas().style.cursor = '';
            });
        });
        map.on('load', function () {
            map.on('click', 'hotels', function (e) {
                new mapboxgl.Popup().setLngLat(e.lngLat).setHTML('<div class="marker-title">' + e.features[0].properties.Name + '</div><div style = "padding-top:5px;"> Hotel Meeting Space: <b>' + e.features[0].properties.Hotel_Meet + '</b></div><div> Hotel Rooms: <b>' + e.features[0].properties.Hotel_Room + '</b></div><div>' + e.features[0].properties.website + '</div>').setMaxWidth("700px").addTo(map);
            });
            map.on('mouseenter', 'hotels', function () {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'hotels', function () {
                map.getCanvas().style.cursor = '';
            });
        });
        map.on('load', function () {
            map.on('click', 'shopping', function (e) {
                new mapboxgl.Popup().setLngLat(e.lngLat).setHTML('<div class="marker-title">' + e.features[0].properties.Name + '</div><div style = "padding-top:5px;">' + e.features[0].properties.website + '</div>').setMaxWidth("700px").addTo(map);
            });
            map.on('mouseenter', 'shopping', function () {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'shopping', function () {
                map.getCanvas().style.cursor = '';
            });
        });
        // station names on hover
        var popup = new mapboxgl.Popup({
            closeButton: false
            , closeOnClick: false
        });
        map.on('mouseenter', 'metromover-stops', function (e) {
            // Change the cursor style as a UI indicator.
            map.getCanvas().style.cursor = 'pointer';
            var coordinates = e.features[0].geometry.coordinates.slice();
            var description = e.features[0].properties.NAME;
            while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
                coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
            }
            popup.setLngLat(coordinates).setHTML('<i>' + description + '</i>').addTo(map);
        });
        map.on('mouseleave', 'metromover-stops', function () {
            map.getCanvas().style.cursor = '';
            popup.remove();
        });

        let hovered = [];
    window.addEventListener('mousemove', function(e) {
        e.point = new mapboxgl.Point(e.clientX, e.clientY);
        
        const features = map.queryRenderedFeatures(e.point, {layers: ['office']});
       

        for (const feature of hovered) {
            map.setFeatureState(feature, {
                'hover-r': r,
                'hover-g': r,
                'hover-b': r
            });
        }
        const seen = {};
        hovered = features;
        let i = 0;
        for (const feature of hovered) {
            if (seen[feature.id]) continue;

            seen[feature.id] = true;
            map.setFeatureState(feature, {
                'hover-r': i === 0 ? 255 : w,
                'hover-g': i === 1 ? 255 : w,
                'hover-b': i >= 2 ? 255 : w
            });
            i++;
        }
         });
  */

function drawmap1(){

}  

function drawmap2(){


map.flyTo({
center: [-80.190701, 25.758105],
zoom: 16.54,
pitch: 73.54,
speed: 0.5
})

for (var i = 0; i < bins; i++) {

map.setPaintProperty(
'room-extrusion' + i,
'fill-extrusion-height',
binWidth * i
);
map.setPaintProperty(
'room-extrusion' + i,
'fill-extrusion-opacity', 0.9);
}

}

function drawmap3(){


map.flyTo({
center: [-80.188060, 25.767957],
zoom: 15.72,
bearing: 59.20,
pitch: 77.00,
speed: 0.5
})

    map.setPaintProperty(
'under-construction',
'fill-extrusion-height',
220
); 

    map.setPaintProperty(
'under-construction',
'fill-extrusion-color', "#F2F234"
); 

} 

function drawmap4(){


d3.json(
            'https://raw.githubusercontent.com/HRAAdvisors/HRAAdvisors.github.io/master/miami/gis/hmm2.geojson',
            function (err, data) {
                if (err) throw err;

                // save full coordinate list for later
                var coordinates = data.features[0].geometry.coordinates;

                // start by showing just the first coordinate
                data.features[0].geometry.coordinates = [coordinates[0]];

                // add it to the map
                map.addSource('trace', { type: 'geojson', data: data });
                map.addLayer({
                    'id': 'trace',
                    'type': 'line',
                    'source': 'trace',
                    'paint': {
                        'line-color': 'yellow',
                        'line-opacity': 0.75,
                        'line-width': 20
                    }
                });

                // setup the viewport

                // on a regular basis, add more coordinates from the saved list and update the map
                var i = 0;
                var timer = window.setInterval(function () {
                    if (i < coordinates.length) {
                        data.features[0].geometry.coordinates.push(
                            coordinates[i]
                        );
                        map.getSource('trace').setData(data);
                        i++;
                    } else {
                        window.clearInterval(timer);
                    }
                }, 10);
            }
        );
  

} 

function drawmap5(){
  
} 

function drawmap6(){
  
} 

function drawmap7(){
  
} 
      let functions2 = [
        drawmap1,
    drawmap2,
    drawmap3,
    drawmap4,
    drawmap5, 
    drawmap6,
    drawmap7]

  var gs2 = d3.graphScroll()
      .container(d3.select('.container-2'))
      .graph(d3.selectAll('.container-2 #graph'))
      .eventId('uniqueId2')  // namespace for scroll and resize events
      .sections(d3.selectAll('.container-2 #sections > div'))
      .on('active', function(i){
        functions2[i]()
      })


}
render()
d3.select(window).on('resize', render)



</script>
    <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=6041a54707ac14648370b006" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="webflow.js" type="text/javascript"></script>

<script>
  ////PROFILES MAP
//Profile Maps

var map2 = new mapboxgl.Map({
            container: 'map2'
            , style: 'mapbox://styles/kpclyne/cjy9ts3mh0y9j1do9uss5fz8o'
            , center: [-80.19393, 25.77054]
            , zoom: 6
            , minZoom: 2
            , maxZoom: 16
            ,interactive: false
        });
        map2.scrollZoom.disable();



map2.on('load', function () {
    map2.resize();

      map2.addSource('greaterdda', {
      'type': 'geojson',
      'data':
      'https://raw.githubusercontent.com/HRAAdvisors/HRAAdvisors.github.io/master/miami/gis/greaterdda.geojsonl.json'
      });
      map2.addLayer(
      {
      'id': 'greaterdda-fill',
      'type': 'fill',
      'source': 'greaterdda',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
      'fill-color': '#f08',
      'fill-opacity': 0.4
      }
    })

      map2.addSource('brickell', {
      'type': 'geojson',
      'data':
      'https://raw.githubusercontent.com/HRAAdvisors/HRAAdvisors.github.io/master/miami/gis/brickell.geojsonl.json'
      });
      map2.addLayer(
      {
      'id': 'brickell-fill',
      'type': 'fill',
      'source': 'brickell',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
      'fill-color': '#f08',
      'fill-opacity': 0.4
      }
    })

    map2.addSource('ae', {
      'type': 'geojson',
      'data':
      'https://raw.githubusercontent.com/HRAAdvisors/HRAAdvisors.github.io/master/miami/gis/ae.geojsonl.json'
      });
      map2.addLayer(
      {
      'id': 'ae-fill',
      'type': 'fill',
      'source': 'ae',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
      'fill-color': '#f08',
      'fill-opacity': 0.4
      }
    })

    map2.addSource('cbd', {
      'type': 'geojson',
      'data':
      'https://raw.githubusercontent.com/HRAAdvisors/HRAAdvisors.github.io/master/miami/gis/cbd.geojsonl.json'
      });
      map2.addLayer(
      {
      'id': 'cbd-fill',
      'type': 'fill',
      'source': 'cbd',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
      'fill-color': '#f08',
      'fill-opacity': 0.4
      }
    })

      map2.addSource('dda', {
      'type': 'geojson',
      'data':
      'https://raw.githubusercontent.com/HRAAdvisors/HRAAdvisors.github.io/master/miami/gis/miamidda.geojsonl.json'
      });
      map2.addLayer(
      {
      'id': 'dda-fill',
      'type': 'fill',
      'source': 'dda',
      'layout': {
        'visibility': 'none'
      },
      'paint': {
      'fill-color': '#f08',
      'fill-opacity': 0.4
      }
    })

    map2.addSource('miamidade', {
      'type': 'geojson',
      'data':
      'https://raw.githubusercontent.com/HRAAdvisors/HRAAdvisors.github.io/master/miami/gis/miamidade.geojsonl.json'
      });
      map2.addLayer(
      {
      'id': 'miamidade-fill',
      'type': 'fill',
      'source': 'miamidade',
      'layout': {},
      'paint': {
      'fill-color': '#f08',
      'fill-opacity': 0.4
      }
    })

    var toggleableLayerIds = [ 'miamidade-fill', 'greaterdda-fill','dda-fill','cbd-fill','ae-fill','brickell-fill' ]

    
    function moveMap(layer,bounds){
      for(var index in toggleableLayerIds) {
                var clickedLayer = toggleableLayerIds[index];
                map2.setLayoutProperty(clickedLayer, 'visibility', 'none');
              }

      map2.setLayoutProperty(layer, 'visibility', 'visible');

      map2.fitBounds(bounds);
    }

    var GDtoggle = document.getElementById('GDButton');
            GDtoggle.addEventListener('click', function (e) {
              moveMap('greaterdda-fill',[
      [-80.214268,
      25.7456244],
      [-80.1710619,
      25.8199841]
    ])   
            });
    var MiamiDadetoggle = document.getElementById('MiamiButton');
        MiamiDadetoggle.addEventListener('click', function (e) {
          moveMap('miamidade-fill',[
      [-80.8735842,
      25.1374249],
      [-80.118074,
      25.9794389]
    ])   
        });
    var DDAtoggle = document.getElementById('DDAButton');
        DDAtoggle.addEventListener('click', function (e) {
          moveMap('dda-fill',[
      [-80.2012045,
      25.7573506],
      [-80.1755337,
      25.8002]])   
        });
    var CBDtoggle = document.getElementById('CBDButton');
            CBDtoggle.addEventListener('click', function (e) {
              moveMap('cbd-fill',[
      [-80.2010044,
      25.7688479],
      [-80.1833007,
      25.782989]
    ])   
            });
    var AEtoggle = document.getElementById('AEButton');
            AEtoggle.addEventListener('click', function (e) {
              moveMap('ae-fill',[
      [-80.1961861,
      25.7827633],
      [-80.1755337,
      25.8002303]
    ])   
            });
    var Brickelltoggle = document.getElementById('BrickellButton');
            Brickelltoggle.addEventListener('click', function (e) {
              moveMap('brickell-fill',[
    [-80.1961369,
    25.7573506],
    [-80.1827413,
    25.7700894]
  ])   
            });

});


////Retention Map
var map3 = new mapboxgl.Map({
            container: 'map3'
            , style: 'mapbox://styles/kpclyne/cklun3glz1uuy17mnm8butfl0'
            , center: [-80.971193, 34.032196]
            , zoom: 3
            , minZoom: 2
            , maxZoom: 16
            ,interactive: false
        });
        map3.scrollZoom.disable();

var popup = new mapboxgl.Popup({
closeButton: false,
closeOnClick: false
});
 
map3.on('mouseenter', 'merged', function (e) {
// Change the cursor style as a UI indicator.
map3.getCanvas().style.cursor = 'pointer';
 
var coordinates = e.features[0].geometry.coordinates.slice();
var description = e.features[0].properties.fullname;
var miamiret = e.features[0].properties.miami;
var fulldesc = '<strong>' + description + '</strong><p>' + String(d3.format(".0%")(miamiret*.01)) + '</p>'
// Ensure that if the map is zoomed out such that multiple
// copies of the feature are visible, the popup appears
// over the copy being pointed to.
while (Math.abs(e.lngLat.lng - coordinates[0]) > 180) {
coordinates[0] += e.lngLat.lng > coordinates[0] ? 360 : -360;
}
 
// Populate the popup and set its coordinates
// based on the feature found.
popup.setLngLat(coordinates).setHTML(fulldesc).addTo(map3);
});
 
map3.on('mouseleave', 'merged', function () {
map3.getCanvas().style.cursor = '';
popup.remove();
});


//document.getElementById('info').innerHTML = "Share of schools’ alumni who move to Miami"

    ///TOP INDUSTRY TABLES

d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=2127750220", function(error, data1) {
      if (error) throw error;
      
      d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=1433347485", function(error, data2) {
      if (error) throw error;
        
      data = data1
      
      var growing = d3
        .select("#GrowingInds")
      
      var largest = d3
        .select("#LargestInds")
      
      
      
      var columns = d3.keys(data[0]);

      var table = d3.select('#top-industries').append("table");
      var thead = table.append("thead");
      var tbody = table.append("tbody");

      thead.append("tr")
        .selectAll("th")
        .data(columns)
        .enter()
        .append("th")
        .text(function(column) { return column; });

      tbody.selectAll("tr")
        .data(data)
        .enter()
        .append("tr")
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .enter()
        .append("td")
        .text(function(d) { return d.value; });
      
      growing
      .on('click', function(d){
        tbody.selectAll("tr")
        .data(data2)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })
      
      largest
      .on('click', function(d){
        tbody.selectAll("tr")
        .data(data1)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })
      
      
      
      
        
      });
    });


/// TOP OCCUPATION TABLE
d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=632495073", function(error, data1) {
      if (error) throw error;
      
      d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=791286037", function(error, data2) {
      if (error) throw error;
        
      data = data1
      
      var growing = d3
        .select("#GrowingOccs")
      
      var largest = d3
        .select("#LargestOccs")
      
      
      
      var columns = d3.keys(data[0]);

      var table = d3.select('#top-occupations').append("table");
      var thead = table.append("thead");
      var tbody = table.append("tbody");

      thead.append("tr")
        .selectAll("th")
        .data(columns)
        .enter()
        .append("th")
        .text(function(column) { return column; });

      tbody.selectAll("tr")
        .data(data)
        .enter()
        .append("tr")
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .enter()
        .append("td")
        .text(function(d) { return d.value; });
      
      growing
      .on('click', function(d){
        tbody.selectAll("tr")
        .data(data2)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })
      
      largest
      .on('click', function(d){
        tbody.selectAll("tr")
        .data(data1)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })
      
        
      });
    });

//////WHO'S HERE TILE SCROLLER

var scoll = 0
 function autoScrollUp(){
          $(".inner").css({top:0}) // jump back
                     .animate({top:-$(".outer").outerHeight()},80000,"linear", autoScrollUp); // and animate
      }
      // fix hight of outer:
      //$('.outer').css({maxHeight: $('.inner').height()});
      // duplicate content of inner:
      $('.inner').html($('.inner').html() + $('.inner').html());


 autoScrollUp();

 $( ".outer" ).scroll(function() {
  $( ".inner" ).stop()
  $( ".inner" ).css({top:0})
});

$( ".inner" ).scroll(function() {
  $( ".inner" ).stop()
  $( ".inner" ).css({top:0})
});


empwidth = document.getElementById("emp").clientWidth



 var padding = 6, cols = 4, radius = ((empwidth/cols)/2) - padding*(1 + (1/(cols+1))), parameter = 'employer';

  var menu = [
            {id: 'size', name: 'Size'},
            {id: 'high', name: 'High ($)'},
            {id: 'low', name: 'Low ($)'},
            {id: 'open', name: 'Open ($)'},
            {id: 'netChange', name: 'Net Change ($)'},
            {id: 'percentChange', name: 'Percent Change (%)'},
          ];
      
 colors = 
   {technology:'#0F48C7',professionalservices:'#EE473B',financial:'#2BB450',food:'#16D2C0',venture:'#2AABE0',utilities:'#BB6C25',transport:'#FF58A3',healthcare:'#BA80F8'}

/// HELPER FUNCTIONS
function translateSVG(x, y) {
  return 'translate('+x+','+y+')';
}

//// UI
function menuClick(d) {
  if(parameter === d.id)
    return;

  d3.select('#menu2').selectAll('div').classed('selected', false);
  d3.select(this).classed('selected', true);

  parameter = d.id;

  updateChart();
}

function selectThis(d) {
  d3.select(this).classed('selected', function() {return !d3.select(this).classed('selected');})
}

//// D3
function updateChart() {

  var nodes = d3.select('#chart')
    .selectAll('div.node')
    .sort(function(a, b) {return parameter === 'ranking' ? d3.ascending(a[parameter], b[parameter]) : d3.descending(a[parameter], b[parameter]);})
    .transition()
    .duration(1000)
    .style('left', function(d, i) {
      var col = i % cols;
      var x = 2 * col * (radius + padding);
      return x + 'px';
    })
    .style('top', function(d, i) {
      var row = Math.floor(i / cols);
      var y = 2 * row * (radius + padding);
      return y + 'px';
    });

  d3.select('#chart')
    .selectAll('div.node .value')
    .transition()
    .duration(0)
    .tween("text", function(d)
      {
        var x = d[parameter];
        if (!(parameter == 'open' || parameter == 'high')) x;
        var i = d3.interpolate(this.textContent, (x));
        return function(t) {
          this.textContent = (i(t));
      };
    });
}

function updateChart2() {

  var nodes = d3.select('#chart2')
    .selectAll('div.node')
    .sort(function(a, b) {return parameter === 'ranking' ? d3.ascending(a[parameter], b[parameter]) : d3.descending(a[parameter], b[parameter]);})
    .transition()
    .duration(1000)
    .style('left', function(d, i) {
      var col = i % cols;
      var x = 2 * col * (radius + padding) + (padding*2);
      return x + 'px';
    })
    .style('top', function(d, i) {
      var row = Math.floor(i / cols);
      var y = 2 * row * (radius + padding);
      return y + 'px';
    });

  d3.select('#chart2')
    .selectAll('div.node .value')
    .transition()
    .duration(0)
    .tween("text", function(d)
      {
        var x = d[parameter];
        if (!(parameter == 'open' || parameter == 'high')) x;
        var i = d3.interpolate(this.textContent, (x));
        return function(t) {
          this.textContent = (i(t));
      };
    });
}

 // Menu
d3.select('#menu2')
  .selectAll('div')
  .data(menu)
  .enter()
  .append('div')
  .text(function(d) {return d.name;})
  .classed('selected', function(d, i) {return i==0;})
  .on('click', menuClick);


    d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=196727768", function(error, data1) {
      if (error) throw error;
    
    var nodes = d3.select('#chart')
                      .selectAll('div')
                      .data(data1)
                      .enter()
                      .append('div')
                      .attr('id', function(d) {return 'entity-'+d.size;})
                      .style('background-color',function(d){ return colors[d.industry]})
                      .classed('node', true)
                      .style('width', 2 * radius + 'px')
                      .style('height', 2 * radius + 'px')
                      .on('click', selectThis);

        nodes
          .append('div')
          .classed('name', true)
          .html(function(d) {return "<br>"})
          .style('width', 2 * radius + 'px');

        nodes
          .append('div')
          .classed('value', true)
          .html(function(d) {return d[parameter]})
          .style('color', '#FFFFFF')
          .style('width', 2 * radius + 'px')
          .style('height', 0.5 * radius + 'px')
          .style('font-size', 15+'px')
          .style('font-weight', 700);
        nodes
          .append('div')
          .classed('name', true)
          .html(function(d) {return d.name})
          .style('width', 2 * radius + 'px');

        updateChart();
  });

    d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=1181381306", function(error, data1) {
      if (error) throw error;
    
    var nodes = d3.select('#chart2')
                      .selectAll('div')
                      .data(data1)
                      .enter()
                      .append('div')
                      .attr('id', function(d) {return 'entity-'+d.size;})
                      .style('background-color',function(d){ return colors[d.industry]})
                      .classed('node', true)
                      .style('width', 2 * radius + 'px')
                      .style('height', 2 * radius + 'px')
                      .on('click', selectThis);

        nodes
          .append('div')
          .classed('name', true)
          .html(function(d) {return "<br>"})
          .style('width', 2 * radius + 'px');

        nodes
          .append('div')
          .classed('value', true)
          .html(function(d) {return d[parameter]})
          .style('color', '#FFFFFF')
          .style('width', 2 * radius + 'px')
          .style('height', 0.5 * radius + 'px')
          .style('font-size', 15+'px')
          .style('font-weight', 700);
        nodes
          .append('div')
          .classed('name', true)
          .html(function(d) {return d.name})
          .style('width', 2 * radius + 'px');

        updateChart2();
  });
 






///EDUCATIONAL ATTAINMENT SLIDER
d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=1283485067", function(error, csv) {
      if (error) throw error;

  var keys = csv.columns.slice(2);

  var year   = [...new Set(csv.map(d => d.Year))]
  var states = [...new Set(csv.map(d => d.Bucket))]


  var svg = d3.select("#educhart"),
    margin = {top: 35, left: 35, bottom: 0, right: 15},
    
    element = svg.node();
    width = element.getBoundingClientRect().width - margin.left - margin.right,
    height = element.getBoundingClientRect().height - margin.top - margin.bottom;

  var y = d3.scaleBand()
    .range([margin.top, height - margin.bottom])
    .padding(0.1)
    .paddingOuter(0.2)
    .paddingInner(0.2)

  var x = d3.scaleLinear()
    .range([margin.left, width - margin.right])

  var yAxis = svg.append("g")
    .attr("transform", `translate(${margin.left},0)`)
    .attr("class", "y-axis")

  var xAxis = svg.append("g")
    .attr("transform", `translate(0,${height})`)
    .attr("class", "x-axis")

  var z = d3.scaleOrdinal()
    .range(["#7F7F7F", "#9DC3E6", "#2E75B6","#002060"])
    .domain(keys);

  update(d3.select("#slide").property("value"), 0)

  function update(input, speed) {

    var data = csv.filter(f => f.Year == input)

    data.forEach(function(d) {
      d.total = d3.sum(keys, k => +d[k])
      return d
    })

    csv.forEach(function(d) {
      d.total = d3.sum(keys, k => +d[k])
      return d
    })

    const maxedu = csv.reduce(
      (max, i) => (i.total > max ? i.total : max),
      csv[0].total
    );

    x.domain([0, maxedu]).nice();

    svg.selectAll(".x-axis").transition().duration(speed)
      .call(d3.axisBottom(x).ticks(null, "s"))


    y.domain(data.map(d => d.Bucket));

    svg.selectAll(".y-axis").transition().duration(speed)
      .call(d3.axisLeft(y).tickSizeOuter(0))

    var group = svg.selectAll("g.layer")
      .data(d3.stack().keys(keys)(data), d => d.key)

    group.exit().remove()

    group.enter().insert("g", ".y-axis").append("g")
      .classed("layer", true)
      .attr("fill", d => z(d.key));

    var bars = svg.selectAll("g.layer").selectAll("rect")
      .data(d => d, e => e.data.Bucket);

    bars.exit().remove()

    bars.enter().append("rect")
      .attr("height", y.bandwidth())
      .merge(bars)
    .transition().duration(speed)
      .attr("y", d => y(d.data.Bucket))
      .attr("x", d => x(d[0]))
      .attr("width", d => x(d[1]) - x(d[0]))

    var text = svg.selectAll(".text")
      .data(data, d => d.Bucket);

    text.exit().remove()

    text.enter().append("text")
      .attr("class", "text")
      .attr("text-anchor", "start")
      .merge(text)
    .transition().duration(speed)
      .attr("y", d => y(d.Bucket) + y.bandwidth() / 2)
      .attr("x", d => x(d.total) + 5)
      .text(d => d.total)
  }


  var slide = d3.select("#slide")
    .on("change", function() {
      update(this.value, 750)
    })

});
  
const allRanges = document.querySelectorAll(".range-wrap");
allRanges.forEach(wrap => {
  const range = wrap.querySelector(".range");
  const bubble = wrap.querySelector(".bubble");

  range.addEventListener("input", () => {
    setBubble(range, bubble);
  });
  setBubble(range, bubble);
});

function setBubble(range, bubble) {
  const val = range.value;
  const min = range.min ? range.min : 0;
  const max = range.max ? range.max : 100;
  const newVal = Number(((val - min) * 100) / (max - min));
  bubble.innerHTML = val;

  // Sorta magic numbers based on size of the native UI thumb
  bubble.style.left = `calc(${newVal}% + (${8 - newVal * 0.15}px))`;
}



//////COLLEGE TOWNS

d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=1381261411", function(error, data) {
  if (error) throw error;

  // format the data
  data.forEach(function(d) {
    d.students = +d.students;
  });
  
  var svg = d3.select("#collegetowns")
  
  var margin = {top: 20, right: 20, bottom: 30, left: 60},
  element = svg.node();
  width = element.getBoundingClientRect().width - margin.left - margin.right,
  height = element.getBoundingClientRect().height - margin.top - margin.bottom;

// set the ranges
var x = d3.scaleBand()
          .range([margin.left, width-margin.right])
          .padding(0.1);
var y = d3.scaleLinear()
          .range([height-margin.bottom, margin.top]);
          
// append the svg object to the body of the page
// append a 'group' element to 'svg'
// moves the 'group' element to the top left margin

    svg
      .append("g")
      .attr("transform", 
          "translate(" + margin.left + "," + margin.top + ")");


  // Scale the range of the data in the domains
  x.domain(data.map(function(d) { return d.city; }));
  y.domain([0, d3.max(data, function(d) { return d.students; })]);

  // append the rectangles for the bar chart
  svg.selectAll(".bar")
      .data(data)
    .enter().append("rect")
      .attr("class", "bar")
      .attr("x", function(d) { return x(d.city); })
      .attr("width", x.bandwidth())
      .attr("y", function(d) { return y(d.students); })
      .attr("height", function(d) { return height - y(d.students); })
      .style ("fill", function(d) {
       if (d.city === "Miami") {return "#EB529D"}  // <== Add these
       else    { return "#A6CEE3" } 
      });

  // add the x Axis
  svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x));

  // add the y Axis
  svg.append("g")
      .attr("transform", "translate("+ margin.left + "," + margin.top + ")")
      .call(d3.axisLeft(y));

});




///////QUALITY

d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=2061632967", function(error, data) {
  if (error) throw error;


  function wrap(text, width) {
        text.each(function() {
            var text = d3.select(this),
                    words = text.text().split(/\s+/).reverse(),
                    word,
                    line = [],
                    lineNumber = 0,
                    lineHeight = 1.1, // ems
                    y = text.attr("y"),
                    dy = parseFloat(text.attr("dy")),
                    tspan = text.text(null).append("tspan").attr("x", 0).attr("y", y).attr("dy", dy + "em");
            while (word = words.pop()) {
                line.push(word);
                tspan.text(line.join(" "));
                if (tspan.node().getComputedTextLength() > width) {
                    line.pop();
                    tspan.text(line.join(" "));
                    line = [word];
                    tspan = text.append("tspan").attr("x", 0).attr("y", y).attr("dy", ++lineNumber * lineHeight + dy + "em").text(word);
                }
            }
        });
    }

    var svg = d3.select("#quality")

    var margin = {top: 20, right: 20, bottom: 30, left: 60},
  element = svg.node();
  width = element.getBoundingClientRect().width - margin.left - margin.right,
  height = element.getBoundingClientRect().height - margin.top - margin.bottom;


  var x = d3.scale.ordinal()
            .rangeRoundBands([0, width], .1,.3);
    var y = d3.scale.linear()
            .rangeRound([height, 0]);
    var colorRange = d3.scale.category20();
    var color = d3.scale.ordinal()
            .range(["#BFBFBF","#0070C0","#EB529D"]);
    var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom");
    var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .tickFormat(d3.format(".2s"));


    svg.append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
    var divTooltip = d3.select("body").append("div").attr("class", "toolTip");
    color.domain(d3.keys(dataset[0]).filter(function(key) { return key !== "label"; }));
    dataset.forEach(function(d) {
        var y0 = 0;
        d.values = color.domain().map(function(name) { return {name: name, y0: y0, y1: y0 += +d[name]}; });
        d.total = d.values[d.values.length - 1].y1;
    });
    x.domain(dataset.map(function(d) { return d.label; }));
    y.domain([0, d3.max(dataset, function(d) { return d.total; })]);
   
   
    var bar = svg.selectAll(".label")
            .data(dataset)
            .enter().append("g")
            .attr("class", "g")
            .attr("transform", function(d) { return "translate(" + x(d.label) + ",0)"; });
 
            
    var bar_enter = bar.selectAll("rect")
    .data(function(d) { return d.values; })
    .enter();

bar_enter.append("rect")
    .attr("width", x.rangeBand())
    .attr("y", function(d) { return y(d.y1); })
    .attr("height", function(d) { return y(d.y0) - y(d.y1); })
    .style("fill", function(d) { return color(d.name); });

bar_enter.append("text")
    .text(function(d) { return d3.format(".1s")(d.y1-d.y0)+" SF"; })
    .attr("y", function(d) { return y(d.y1)+(y(d.y0) - y(d.y1))/2; })
    .attr("x", x.rangeBand()/2.2)
    .style("fill", '#ffffff')
    .style("font-size", '30px')
    .style("font-weight", '600');
  
bar_enter.append("text")
    .text(function(d) { return d.name })
    .attr("y", function(d) { return y(d.y1)+(y(d.y0) - y(d.y1))/2; })
    .attr("x", x.rangeBand()*1.01)
    .style("fill", function(d) { return color(d.name); })
    .style("font-size", '30px')
    .style("font-weight", '600');

  });


////// DISTRICT PROFILES
d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=1939873973", function(error, data1) {
      if (error) throw error;
      
      d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=342967098", function(d){
  return{
    class: d.class,
    businesses: +d.businesses,
    population: +d.population,
    employees: +d.employees
  };
}, function(error, rows) {
      if (error) throw error;
        
      data = data1.filter(f => f.geo == 'miami')
      data.forEach(function(v){ delete v.geo });

      var button = d3
      .selectAll('.dbutton')

      var miami = d3
        .select("#MiamiButton")
      
      var gd = d3
        .select("#GDButton")

      var dda = d3
        .select("#DDAButton")
        
      var cbd = d3
        .select("#CBDButton")

      var ae = d3
        .select("#AEButton")

      var brickell = d3
        .select("#BrickellButton") 


      var businesses = d3.select("#businesses")
      .append("svg")
      .append("text")
        .text(d3.format("(,.2r")(rows[0].businesses))
        .attr("x", 10)
        .attr("y", 40)
        .attr("class", "label")
        .style("font-weight", 700)
        .style('font-size',40)
        .style('fill','#FFFFFF')

    var population = d3.select("#population")
      .append("svg")
      .append("text")
        .text(d3.format("(,.2r")(rows[0].population))
        .attr("x", 10)
        .attr("y", 40)
        .attr("class", "label")
        .style("font-weight", 700)
        .style('font-size',40)
        .style('fill','#FFFFFF')

    var employees = d3.select("#employees")
      .append("svg")
      .append("text")
        .text(d3.format("(,.2r")(rows[0].employees) )
        .attr("x", 10)
        .attr("y", 40)
        .attr("class", "label")
        .style("font-weight", 700)
        .style('font-size',40)
        .style('fill','#FFFFFF') 
          
      
      
      var columns = d3.keys(data[0]);

      var table = d3.select('#conditions').append("table");
      var thead = table.append("thead");
      var tbody = table.append("tbody");

      thead.append("tr")
        .selectAll("th")
        .data(columns)
        .enter()
        .append("th")
        .text(function(column) { return column; });

      tbody.selectAll("tr")
        .data(data)
        .enter()
        .append("tr")
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .enter()
        .append("td")
        .text(function(d) { return d.value; })
        .style("color","#000000");
      
      miami
      .on('click', function(d){

        newdata = data1.filter(f => f.geo == 'miami')
        newdata.forEach(function(v){ delete v.geo });

        button
        .style("color","#FFFFFF")
        .style("background-color", "#D3D3D3")
        
        miami
        .style("background-color", "#FFFFFF")
        .style("color","#242358")
        
        businesses
          .text(d3.format("(,.2r")(rows[0].businesses))
        population
          .text(d3.format("(,.2r")(rows[0].population))
        employees
          .text(d3.format("(,.2r")(rows[0].employees))



        tbody.selectAll("tr")
        .data(newdata)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })
      
      gd
      .on('click', function(d){

        var newdata = data1.filter(f => f.geo == 'gd')
        newdata.forEach(function(v){ delete v.geo });

        button
        .style("color","#FFFFFF")
        .style("background-color", "#D3D3D3")
        
        gd
        .style("background-color", "#FFFFFF")
        .style("color","#242358")
        
        businesses
          .text(d3.format("(,.2r")(rows[1].businesses))
        population
          .text(d3.format("(,.2r")(rows[1].population))
        employees
          .text(d3.format("(,.2r")(rows[1].employees))


        tbody.selectAll("tr")
        .data(newdata)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })

      dda
      .on('click', function(d){

        var newdata = data1.filter(f => f.geo == 'dda')
        newdata.forEach(function(v){ delete v.geo });

        button
        .style("color","#FFFFFF")
        .style("background-color", "#D3D3D3")
        
        dda
        .style("background-color", "#FFFFFF")
        .style("color","#242358")
        
        businesses
          .text(d3.format("(,.2r")(rows[2].businesses))
        population
          .text(d3.format("(,.2r")(rows[2].population))
        employees
          .text(d3.format("(,.2r")(rows[2].employees))


        tbody.selectAll("tr")
        .data(newdata)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })

      cbd
      .on('click', function(d){

        var newdata = data1.filter(f => f.geo == 'cbd')
        newdata.forEach(function(v){ delete v.geo });

        button
        .style("color","#FFFFFF")
        .style("background-color", "#D3D3D3")
        
        cbd
        .style("background-color", "#FFFFFF")
        .style("color","#242358")

        businesses
          .text(d3.format("(,.2r")(rows[3].businesses))
        population
          .text(d3.format("(,.2r")(rows[3].population))
        employees
          .text(d3.format("(,.2r")(rows[3].employees))


        tbody.selectAll("tr")
        .data(newdata)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })

      ae
      .on('click', function(d){

        var newdata = data1.filter(f => f.geo == 'ae')
        newdata.forEach(function(v){ delete v.geo });

        button
        .style("color","#FFFFFF")
        .style("background-color", "#D3D3D3")
        
        ae
        .style("background-color", "#FFFFFF")
        .style("color","#242358")
        
        businesses
          .text(d3.format("(,.2r")(rows[4].businesses))
        population
          .text(d3.format("(,.2r")(rows[4].population))
        employees
          .text(d3.format("(,.2r")(rows[4].employees))


        tbody.selectAll("tr")
        .data(newdata)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })

      brickell
      .on('click', function(d){

        var newdata = data1.filter(f => f.geo == 'brickell')
        newdata.forEach(function(v){ delete v.geo });

        button
        .style("color","#FFFFFF")
        .style("background-color", "#D3D3D3")
        
        brickell
        .style("background-color", "#FFFFFF")
        .style("font-color","#242358")
        
        businesses
          .text(d3.format("(,.2r")(rows[5].businesses))
        population
          .text(d3.format("(,.2r")(rows[5].population))
        employees
          .text(d3.format("(,.2r")(rows[5].employees))


        tbody.selectAll("tr")
        .data(newdata)
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .text(function(d) {return d.value;});
        
      })
      
        
      });
    });
</script>