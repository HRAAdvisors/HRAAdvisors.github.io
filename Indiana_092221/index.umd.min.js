! function(t, n) {
    "object" == typeof exports && "undefined" != typeof module ? module.exports = n() : "function" == typeof define && define.amd ? define(n) : (t = "undefined" != typeof globalThis ? globalThis : t || self).LegendControl = n()
}(this, (function() {
    "use strict";

    function t(t, n) {
        for (var e = 0; e < n.length; e++) {
            var r = n[e];
            r.enumerable = r.enumerable || !1, r.configurable = !0, "value" in r && (r.writable = !0), Object.defineProperty(t, r.key, r)
        }
    }

    function n(t, n) {
        return r(t) || function(t, n) {
            var e = null == t ? null : "undefined" != typeof Symbol && t[Symbol.iterator] || t["@@iterator"];
            if (null == e) return;
            var r, a, o = [],
                i = !0,
                c = !1;
            try {
                for (e = e.call(t); !(i = (r = e.next()).done) && (o.push(r.value), !n || o.length !== n); i = !0);
            } catch (t) {
                c = !0, a = t
            } finally {
                try {
                    i || null == e.return || e.return()
                } finally {
                    if (c) throw a
                }
            }
            return o
        }(t, n) || o(t, n) || c()
    }

    function e(t) {
        return function(t) {
            if (Array.isArray(t)) return i(t)
        }(t) || a(t) || o(t) || function() {
            throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
        }()
    }

    function r(t) {
        if (Array.isArray(t)) return t
    }

    function a(t) {
        if ("undefined" != typeof Symbol && null != t[Symbol.iterator] || null != t["@@iterator"]) return Array.from(t)
    }

    function o(t, n) {
        if (t) {
            if ("string" == typeof t) return i(t, n);
            var e = Object.prototype.toString.call(t).slice(8, -1);
            return "Object" === e && t.constructor && (e = t.constructor.name), "Map" === e || "Set" === e ? Array.from(t) : "Arguments" === e || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e) ? i(t, n) : void 0
        }
    }

    function i(t, n) {
        (null == n || n > t.length) && (n = t.length);
        for (var e = 0, r = new Array(n); e < n; e++) r[e] = t[e];
        return r
    }

    function c() {
        throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")
    }
    var l = function(t) {
            return Array.isArray(t) ? t : [t]
        },
        u = function(t, n, e) {
            var r = arguments.length > 3 && void 0 !== arguments[3] ? arguments[3] : 0,
                a = arguments.length > 4 && void 0 !== arguments[4] ? arguments[4] : 100;
            return (t - n) * (a - r) / (e - n) + r
        },
        s = function(t, n) {
            return Array.from({
                length: Math.ceil(t.length / n)
            }, (function(e, r) {
                return t.slice(r * n, r * n + n)
            }))
        },
        f = function(t) {
            for (var n = arguments.length, r = new Array(n > 1 ? n - 1 : 0), a = 1; a < n; a++) r[a - 1] = arguments[a];
            return t.map((function(t, n) {
                return r.reduce((function(t, r) {
                    return [].concat(e(t), [r[n]])
                }), [t])
            }))
        },
        p = function(t) {
            return 2 === t.length ? t : [null].concat(e(t))
        },
        d = function(t) {
            var r = arguments.length > 1 && void 0 !== arguments[1] ? arguments[1] : {},
                a = r.classes,
                o = r.styles,
                i = r.attributes,
                c = r.content,
                u = r.appendTo,
                s = document.createElement(t);
            return a && l(a).forEach((function(t) {
                return s.classList.add(t)
            })), o && Object.entries(o).forEach((function(t) {
                var n;
                return (n = s.style).setProperty.apply(n, e(t))
            })), i && Object.entries(i).forEach((function(t) {
                var e = n(t, 2),
                    r = e[0],
                    a = e[1];
                s[r] = a
            })), s.append.apply(s, e(l(c).filter((function(t) {
                return null != t
            })))), u && u.appendChild(s), s
        },
        y = function(t, n) {
            var e = n || {},
                r = e.labels,
                a = void 0 === r ? {} : r,
                o = e.unit,
                i = void 0 === o ? "" : o;
            return Array.isArray(t) ? t[1] ? t.map((function(t) {
                return a[t] || "".concat(t).concat(i)
            })).join(" - ") : "+".concat(a[t[0]] || "".concat(t[0]).concat(i)) : null !== t ? a[t] || "".concat(t).concat(i) : a.other || "other"
        },
        m = {
            color: function(t, e) {
                if (!t) return null;
                switch (t.name) {
                    case "interpolate":
                        return function(t, e) {
                            var r = e.metadata;
                            if (!t) return null;
                            var a = t.inputs,
                                o = t.stops,
                                i = t.min,
                                c = t.max,
                                l = o.map((function(t) {
                                    var e = n(t, 2),
                                        r = e[0],
                                        a = e[1];
                                    return "".concat(a, " ").concat(u(r, i, c), "%")
                                }));
                            return d("div", {
                                classes: "gradient",
                                content: [d("p", {
                                    classes: "labels",
                                    content: a.map((function(t) {
                                        return d("span", {
                                            styles: {
                                                left: "".concat(u(t, i, c), "%")
                                            },
                                            content: y(t, r)
                                        })
                                    }))
                                }), d("div", {
                                    classes: "bar",
                                    styles: {
                                        "background-image": "linear-gradient(90deg, ".concat(l, ")")
                                    }
                                })]
                            })
                        }(t, e);
                    case "match":
                    case "step":
                    case "literal":
                        return function(t, e) {
                            var r = e.metadata;
                            return t ? d("ul", {
                                classes: ["list", "list--color"],
                                content: t.stops.map((function(t) {
                                    var e = n(t, 2),
                                        a = e[0],
                                        o = e[1];
                                    return d("li", {
                                        styles: {
                                            "--color": o
                                        },
                                        content: y(a, r)
                                    })
                                }))
                            }) : null
                        }(t, e);
                    default:
                        return
                }
            },
            radius: function(t, e) {
                var r = e.metadata;
                return t ? d("ul", {
                    classes: "bubbles",
                    content: t.stops.sort((function(t, n) {
                        return n[1] - t[1]
                    })).map((function(t) {
                        var e = n(t, 2),
                            a = e[0],
                            o = e[1];
                        return d("li", {
                            styles: {
                                "--radius": "".concat(o, "px")
                            },
                            content: d("span", {
                                content: y(a, r)
                            })
                        })
                    }))
                }) : null
            },
            image: function(t, e, r) {
                var a = e.metadata;
                return t ? d("ul", {
                    classes: ["list", "list--icons"],
                    content: t.stops.map((function(t) {
                        var e = n(t, 2),
                            o = e[0],
                            i = e[1],
                            c = r.style.imageManager.images[i].data,
                            l = c.height,
                            u = c.width,
                            s = c.data,
                            f = Math.max(u, l),
                            p = d("canvas", {
                                attributes: {
                                    width: f,
                                    height: f
                                }
                            }),
                            m = p.getContext("2d"),
                            h = (f - u) / 2,
                            v = (f - l) / 2,
                            g = new ImageData(Uint8ClampedArray.from(s), u, l);
                        return m.putImageData(g, h, v), d("li", {
                            content: [d("img", {
                                classes: ["icon"],
                                attributes: {
                                    src: p.toDataURL()
                                }
                            }), y(o, a)]
                        })
                    }))
                }) : null
            }
        },
        h = {
            literal: function(t) {
                return [
                    [].concat(e(t), e(t))
                ]
            },
            interpolate: function(t) {
                return s(t.slice(2), 2)
            },
            match: function(t) {
                return s(t.slice(1), 2).map(p)
            },
            step: function(t) {
                return r = [].concat(e(s(t.slice(2), 2)), [
                    [null, t[1]]
                ]), a = r.find((function(t) {
                    return null === n(t, 1)[0]
                })), r.reduce((function(t, e, o) {
                    var i = n(e, 2),
                        c = i[0],
                        l = i[1];
                    return o === r.length - 1 ? t.push([c, l]) : l !== a[1] && t.push([
                        [c, r[o + 1][0]], l
                    ]), t
                }), []);
                var r, a
            }
        },
        v = function(t) {
            return Array.isArray(t) && t.length && "string" == typeof t[0]
        },
        g = function(t) {
            var i, l = v(t) ? t : ["literal", t],
                u = r(i = l) || a(i) || o(i) || c(),
                s = u[0],
                p = u.slice(1),
                d = h[s](p),
                y = n(f.apply(void 0, e(d)), 2),
                m = y[0];
            return {
                name: s,
                stops: d,
                inputs: m,
                outputs: y[1],
                min: Math.min.apply(Math, e(m)),
                max: Math.max.apply(Math, e(m))
            }
        },
        b = {
            collapsed: !1,
            toggler: !1,
            layers: void 0
        };
    return function() {
        function r(t) {
            ! function(t, n) {
                if (!(t instanceof n)) throw new TypeError("Cannot call a class as a function")
            }(this, r), this._class = "mapboxgl-ctrl-legend", this._options = Object.assign({}, b, t), this._loadLayer = this._loadLayer.bind(this)
        }
        var a, o, i;
        return a = r, (o = [{
            key: "onAdd",
            value: function(t) {
                return this._map = t, this._container = d("div", {
                    classes: ["mapboxgl-ctrl", this._class]
                }), this._map.on("styledata", this._loadLayer), this._container
            }
        }, {
            key: "onRemove",
            value: function() {
                this._container.parentNode.removeChild(this._container), this._map.off("styledata", this._loadLayer), this._map = void 0
            }
        }, {
            key: "_loadLayer",
            value: function() {
                var t = this,
                    r = this._options,
                    a = r.collapsed,
                    o = r.toggler,
                    i = r.layers,
                    k = r.layers;
                this._map.getStyle().layers.filter((function(t) {
                    var n = t.id;
                    return !i || i.find((function(t) {
                        return n.match(t)
                    }))
                })).filter((function(t) {
                    var n = t.source;
                    return n && "composite" !== n
                })).reverse().forEach((function(r) {
                    var i = r.id,
                        c = r.layout,
                        l = r.paint,
                        u = r.metadata,
                        s = "".concat(t._class, "-pane--").concat(i),
                        f = document.querySelector(".".concat(s)),
                        p = f ? f.open : !a,
                        y = d("details", {
                            classes: ["".concat(t._class, "-pane"), s],
                            attributes: {
                                open: p
                            },
                            content: [d("summary", {
                                content: [u && u.name || i].concat(e(o ? [t._toggleButton(i,k)] : []))
                            })].concat(e(Object.entries(Object.assign({}, c, l)).map((function(e) {
                                var a = n(e, 2),
                                    o = a[0],
                                    i = a[1],
                                    c = n(o.split("-"), 2)[1],
                                    l = g(i),
                                    u = m[c];
                                return u && u(l, r, t._map)
                            }))))
                        });
                    f ? t._container.replaceChild(y, f) : t._container.appendChild(y)
                }))
            }
        }, {
            key: "_toggleButton",
            value: function(t,k) {
            	k = k.filter(item => item !== t)
            	if (t != 'dot-fake'){
            		k.push('dotdensity-map')
            	}
                var n = this,
                    e = this._map.getLayoutProperty(t, "visibility") || "visible";
                return d("div", {
                    classes: ["toggler", "toggler--".concat(e)],
                    attributes: {
                        onclick: function(r) {
                            r.preventDefault();
                            var a = "none" === e ? "visible" : "none";
                            n._map.setLayoutProperty(t, "visibility", a);
                            k.forEach(b => n._map.setLayoutProperty(b, 'visibility', 'none'))
                            if (t == 'dot-fake') {
                                n._map.setLayoutProperty('dotdensity-map', 'visibility', a)
                            }
                        }
                    }
                })
            }
        }]) && t(a.prototype, o), i && t(a, i), r
    }()
}));
//# sourceMappingURL=index.umd.min.js.map
