(this["webpackJsonp@flowmap.blue/app"]=this["webpackJsonp@flowmap.blue/app"]||[]).push([[7],{816:function(e,t,n){"use strict";n.r(t);var c=n(339),o=n.n(c),a=n(73),s=n(796),l=n(178),r=n(357),i=n(35),u=n(0),f=n(790),h=n(766);const b=new Map;var d=e=>f.connect.defaults({fetch:(e,t)=>{const n=new Request(e,t),c="".concat(n.url),o=b.get(c);return o?new Promise((e=>e(o.response.clone()))):(n.headers.set("Content-Type","text/plain"),fetch(n).then((e=>(b.set(c,{response:e.clone()}),e))))},handleResponse:function(t){if("0"===t.headers.get("content-length")||204===t.status)return;const n=t.text();return t.status>=200&&t.status<300?n.then((t=>new Promise(((n,c)=>{let o;try{switch(e){case"json":const e=function(e){const t=e.indexOf("{"),n=e.lastIndexOf("}");if(t>=0&&n>=t)return JSON.parse(e.substring(t,n+1))}(t);if(o=function(e){if(!e||!e.table||!e.table.cols||!e.table.rows)return[];const t=e.table.cols.length,n=e=>{if(null!=e&&(null!=e.v||null!=e.f))return"".concat(null!=e.v?e.v:e.f).trim()};let c,o;e.table.cols.find((e=>null!=e.label&&e.label.length>0))?(c=e.table.rows,o=e.table.cols.map((({label:e})=>"".concat(e).trim()))):(c=e.table.rows.slice(1),o=e.table.rows[0].c.map(n));return c.map((e=>{const c={};for(let s=0;s<t;s++)try{const t="".concat(o[s]).trim();if(e.c&&e.c[s]){const o=n(e.c[s]);if(null!=o&&w(o)){const e=O(o);e?c[t]=e:(console.warn("Couldn't parse date ".concat(o)),c[t]=o)}else c[t]=o}}catch(a){console.warn("Couldn't parse row ".concat(s," from sheet"))}return c}))}(e),"ok"!==e.status)throw new Error("Error loading data from Google Sheets");break;case"csv":o=Object(h.b)(t)}n(o)}catch(a){console.error(a),c(a)}})))):n.then((e=>Promise.reject(new Error(e))))}});const p=(e,t,n,c="json")=>"".concat("https://docs.google.com/spreadsheets/d","/").concat(e,"/gviz/tq?tq=").concat(encodeURI("".concat(n," OPTIONS no_format")),"&tqx=out:").concat(c,"&sheet=").concat(encodeURIComponent(t));const j=/^Date\((\d{4}),(\d+),(\d+),(\d+),(\d+),(\d+)\)$/;function w(e){return null!=e&&e.startsWith("Date")&&j.test(e)}function O(e){if(null!=e){const t=j.exec(e);if(t)return new Date(+t[1],+t[2],+t[3],+t[4],+t[5],+t[6])}}var g=n(25),v=n(439);function m(e,t,n,c){if("ga"in window)try{const o=window.ga.getAll()[0];o&&o.send("event",Object(r.a)({eventCategory:e,eventAction:t,eventLabel:n},null!=c&&{eventValue:c}))}catch(o){console.error("Failed sending ga event",o)}}var x,S=n(817),E=n(169),T=n(46),F=n(803),y=n(791),I=n.n(y),L=n(72),C=n(12),N=n(2);const k=C.a.div(x||(x=Object(i.a)(["\n  font-size: 12px;\n"]))),A=Object(F.a)(d("json")((({spreadSheetKey:e,config:t,flowsSheet:n="flows"})=>({locationsFetch:{url:p(e,"locations","SELECT A,B,C,D","json"),then:e=>({value:e.map((({id:e,name:t,lon:n,lat:c})=>({id:"".concat(e),name:null!==t&&void 0!==t?t:e,lon:+n,lat:+c})))})},flowsFetch:{url:p(e,n,"SELECT *","json"),refreshing:!0,then:e=>({value:Object(g.n)(e)})}}))),Object(F.b)((e=>({locationsFetch:Object(r.a)(Object(r.a)({},e.locationsFetch),{},{loading:e.locationsFetch.pending||e.locationsFetch.refreshing}),flowsFetch:Object(r.a)(Object(r.a)({},e.flowsFetch),{},{loading:e.flowsFetch.pending||e.flowsFetch.refreshing})}))))(g.l),R=e=>I()(e).substr(0,7);t.default=({spreadSheetKey:e,flowsSheetKey:t,embed:n})=>{const c=p(e,"properties","SELECT A,B","csv"),i=Object(u.useState)(),f=Object(l.a)(i,2),b=f[0],d=f[1],j=Object(L.f)(),w=(t,c)=>{c&&j.replace(Object(r.a)(Object(r.a)({},j.location),{},{pathname:"/".concat(e,"/").concat(R(t)).concat(n?"/embed":"")})),d(t)},O=Object(S.a)(Object(s.a)(o.a.mark((function n(){var s,l,i,u,f,b,d,p;return o.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(c);case 2:return s=n.sent,n.t0=h.b,n.next=6,s.text();case 6:n.t1=n.sent,l=(0,n.t0)(n.t1),i=Object(r.a)({},g.f),u=Object(a.a)(l);try{for(u.s();!(f=u.n()).done;)null!=(b=f.value).value&&"".concat(b.value).length>0&&(i[b.property]=b.value)}catch(o){u.e(o)}finally{u.f()}return m("".concat(e,' "').concat(i[g.e.TITLE]||"Untitled",'"'),"Load config",'Load config "'.concat(i[g.e.TITLE]||"Untitled",'"')),(d=Object(g.m)(i))&&d.length>0&&(p=void 0,null!=(p=t?d.find((e=>R(e)===t)):d[0])&&w(p,d.length>1)),n.abrupt("return",i);case 15:case"end":return n.stop()}}),n)}))),[c]);return Object(u.useEffect)((()=>{O.error&&g.a.show({intent:E.a.WARNING,icon:T.a.WARNING_SIGN,timeout:0,message:Object(N.jsxs)(k,{children:["Oops\u2026 The properties sheet couldn't be loaded:",Object(N.jsx)("br",{}),O.error.message]})})}),[O.error]),Object(N.jsxs)(g.j,{embed:n,children:[O.loading?Object(N.jsx)(g.h,{}):Object(N.jsx)(A,{spreadSheetKey:e,embed:n,config:O.value?O.value:g.f,flowsSheet:b,onSetFlowsSheet:e=>w(e,!0)}),O.value&&O.value[g.e.TITLE]&&Object(N.jsxs)(v.a,{children:[Object(N.jsx)("title",{children:"".concat(O.value[g.e.TITLE]," - Flowmap.blue")}),Object(N.jsx)("link",{href:"https://flowmap.blue/".concat(e),rel:"canonical"})]})]})}}}]);
//# sourceMappingURL=7.14fc74bf.chunk.js.map