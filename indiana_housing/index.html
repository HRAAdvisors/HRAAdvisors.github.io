<!DOCTYPE html>
<html data-wf-page="60ad049143fb2539268f7d05" data-wf-site="60ad049043fb256ced8f7cd5">
<head>
  <meta charset="utf-8">
  <title>Indiana Housing Dashboard</title>
  <meta content="[Description]" name="description">
  <meta content="Indiana Housing Dashboard" property="og:title">
  <meta content="[Description]" property="og:description">
  <!--<meta content="https://uploads-ssl.webflow.com/5cbc1cadfad96c3229989372/5d0e38fde5d1e7c2d43129f9_opengraph_flowbase.png" property="og:image"> -->
  <meta content="Indiana Housing Dashboard" property="twitter:title">
  <meta content="[Description]" property="twitter:description">
  <!--<meta content="https://uploads-ssl.webflow.com/5cbc1cadfad96c3229989372/5d0e38fde5d1e7c2d43129f9_opengraph_flowbase.png" property="twitter:image"> -->
  <meta property="og:type" content="website">
  <meta content="summary_large_image" name="twitter:card">
  <meta content="width=device-width, initial-scale=1" name="viewport">
  <link href="css/normalize.css" rel="stylesheet" type="text/css">
  <link href="css/webflow.css" rel="stylesheet" type="text/css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Turf.js/0.0.124/turf.min.js" integrity="sha512-jpnZ8xGKbS7L9S6d5fk/zDVgF6OoVKLMoEliLxf24BRX+orWhxqJuUcoM+vGmOaozS9dD9ABjQZKAgjjcwTndA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://d3js.org/d3.v4.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
  <script src="https://d3js.org/d3-array.v1.min.js"></script>
  <script src="https://d3js.org/d3-format.v2.min.js"></script>
  <script src="https://d3js.org/d3-geo.v1.min.js"></script>
  <link href="css/indiana-a6357d.webflow.css" rel="stylesheet" type="text/css">
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
  <link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css" />
  <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script>
  <script type="text/javascript">WebFont.load({  google: {    families: ["Varela Round:400","Cabin:regular,500,500italic,600,600italic,700"]  }});</script>
  <!-- [if lt IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js" type="text/javascript"></script><![endif] -->
  <script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script>
  <link href="images/favicon.png" rel="shortcut icon" type="image/x-icon">
  <link href="images/webclip.png" rel="apple-touch-icon">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/microplugin/0.0.3/microplugin.min.js" integrity="sha512-7amIsiQ/hxbdPNawBZwmWBWPiwQRNEJlxTj6eVO+xmWd71fs79Iydr4rYARHwDf0rKHpysFxWbj64fjPRHbqfA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script> 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/selectize.js/0.13.3/js/selectize.min.js" integrity="sha512-JiDSvppkBtWM1f9nPRajthdgTCZV3wtyngKUqVHlAs0d5q72n5zpM3QMOLmuNws2vkYmmLn4r1KfnPzgC/73Mw==" crossorigin="anonymous" referrerpolicy="no-referrer" defer></script>
  <style type="text/css">
      .mapboxgl-ctrl-logo{
        display:none !important;
        }
      .mapboxgl-ctrl-bottom-right{
        display:none !important;
        }
      .mapboxgl-ctrl-bottom-left{
        display:none !important;
        }
      .css-9emwa5{
        display:none !important;
        }
      .deck-tooltip {
        font-family: Helvetica, Arial, sans-serif;
        padding: 6px !important;
        margin: 8px;
        max-width: 300px;
        font-size: 10px;
        }
      .line {
        fill: none;
        stroke: #ffab00;
        stroke-width: 6;
        }
      .tick line{
        visibility:hidden;
        }
      .overlay {
        fill: none;
        pointer-events: all;
        }
      .dot {
        fill: #ffab00;
        stroke: #fff;
        }
      .focus circle {
        fill: none;
        stroke: steelblue;
        }
      div.tooltip2 { 
        position: absolute;     
        text-align: center;               
        padding: 10px;       
        font: 12px sans-serif;    
        background: #fff;
        border: 2px solid #000;   
        border-radius: 5px;     
        pointer-events: none;
        -moz-border-radius:5px;
        color: black
        z-index: 10;     
        }
      span {
        position: absolute;
        }
      table{
        width: -webkit-fill-available;
        text-align: center;
        }
  </style>
</head>
<body class="lnd_body">
  <div class="tab03">
    <div class="tab03_container">
      <div data-duration-in="300" data-duration-out="100" class="tab03_tabs w-tabs">
        <div class="tab03_menu w-tab-menu">
          <div class="container w-container">
            <div class="text-block-42">
              What is the state of 
              <select class="js-example-basic-single" name="state" id="topic">
                <option value="population">the population</option>
                <option value="housing">housing</option>
                <option value="housingafford">housing affordability</option>
                <option value="jobs">jobs</option>
              </select>
               in 
              <select class="js-example-basic-single" id="geography">
                <option value="Indiana">Indiana</option>
              </select> ?
            </div>
          </div>
          <a data-w-tab="Tab 4" class="tab03_tab_link w-inline-block w-tab-link w--current">
          <div class="tab03_icon_wrap"><img src="images/map_icon.svg" alt="" class="tab03_icon"></div>
          <div class="tab03_title">Map</div>
          </a>
          <a data-w-tab="Tab 5" class="tab03_tab_link w-inline-block w-tab-link">
            <div class="tab03_icon_wrap"><img src="images/compare_icon.svg" alt="" class="tab03_icon"></div>
            <div class="tab03_title">Compare</div>
          </a>
        </div>
        <div class="tab03_content w-tab-content">
          <div data-w-tab="Tab 4" class="tab03_pane w-tab-pane w--tab-active">
            <div class="tab03_tab_content">
              <div class="tab03_block_left">
                <div class="w-layout-grid grid">
                  <div id='chart1'><b><span id='label1'>Population</span></b></div>
                  <div id='chart2'><b><span id='label2'>Median Income</span></b></div>
                  <div id='chart3'><b><span id='label3'>Household Income Distribution</span></b></div>
                  <div id='chart4'><b><span id='label4'>Family Poverty Rate</span></b></div>
                  <div id='chart5'><b><span id='label5'>Tenure</span></b></div>
                  <div id='chart6'><b><span id='label6'>Race</span></b></div>
                </div>
              </div>
              <div class="tab03_block_right">
                <div class="div-block-124" id = 'map'></div>
              </div>
            </div>
          </div>
          <div data-w-tab="Tab 5" class="tab03_pane w-tab-pane">
            <div class="tab03_tab_content">
              <div class="columns w-row">
                <div class="column-2 w-col w-col-1">
                  <div class="w-layout-grid grid-2">
                    <div style='background-color: gray; height:45px'></div>
                    <div style='background-color: gray; height:45px'></div>
                    <div style='background-color: gray; height:45px'></div>
                    <div style='background-color: gray; height:45px'></div>
                    <div style='height:45px'></div>
                    <div style='background-color: gray; height:45px'></div>
                  </div>
                </div>
                <div class="column-3 w-col w-col-11" id='table'></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="section"><img src='images/logo.png' style='padding-left:25vw'></img></div>
  <script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=60ad049043fb256ced8f7cd5" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
  <script src="js/webflow.js" type="text/javascript"></script>
  <script src="js/turf.min.js"></script>
  <!-- [if lte IE 9]><script src="https://cdnjs.cloudflare.com/ajax/libs/placeholders/3.0.2/placeholders.min.js"></script><![endif] -->
</body>
<script>

//Define Labels
span = ['#label1','#label2','#label3','#label4','#label5','#label6']
population = ['Population','Median Income','Household Income Distribution','Family Poverty Rate','Tenure','Race']
housing = ['Housing Units by Typology','Housing Units by Decade Built','Median Listing Price','Median Rent','Housing Starts','Affordable Housing Starts']
housingafford = ['Cost Burdened Households','Cost Burden by Tenure','Cost Burden by Income','Rental Housing Gap','Home Value Affordable to Median Household','']
jobs = ['Unemployment Rate','Net New Jobs','Top 5 Industries by Jobs','Median Salary','Inflow/Outflow','']

//Function to relabel spans when topic is changed
reLabel = function(spans,labels){
  spans.forEach(function(d,i){
    document.querySelector(d).innerHTML = labels[i]
    } )
  } 


//Make Tooltip
var tip = d3.select("body").append("div") 
    .attr("class", "tooltip2")
    .style("position","absolute")       
    .style("opacity", 0);

//Define diminisons of chart modules based on the initial div dimensions of the first chart
var margin = {top: 30, right: 30, bottom: 30, left: 30}
var divs = d3.select('#chart1')
element = divs.node();
width = element.getBoundingClientRect().width  - margin.left - margin.right,
height = element.getBoundingClientRect().height - margin.top - margin.bottom;


//Select the Topic Select Box
//const topic = document.querySelector('#topic')

//Define a method to dynamically resize the select box based on selected text length; Initialize based on starting text.
//The second argument is True (1) if the resize is performed on initial page load or False (0) upon new selection
function selectResize(id,initial){
  const select = document.querySelector(id) 

  //We need to make temporary selections with only one options to grab the DOM evaluated width of the container 
  let tempSelect = document.createElement('select'),
      tempOption = document.createElement('option');

  if (initial == 1){
    tempOption.textContent = select.getElementsByTagName("option")[0].text;
    }else{
    tempOption.textContent = event.target.options[event.target.selectedIndex].text;
    }

  tempSelect.style.cssText += `
    visibility: hidden;
    position: fixed;
    `;
  tempSelect.appendChild(tempOption);

  if (initial == 1){
    select.after(tempSelect)
    width = tempSelect.getBoundingClientRect().width
    select.style.width = `${width}px`;
    }else{
    event.target.after(tempSelect)
    width = tempSelect.getBoundingClientRect().width
    event.target.style.width = `${width}px`;
    }
  tempSelect.remove()

  return tempOption.textContent
  }

//Perform initial resize
selectResize('#topic',1)


topic.addEventListener('change', (event) => {
  
  //Relabel Spans
  label = eval(event.target.options[event.target.selectedIndex].value)
  reLabel(span,label)

  selectResize('#topic',0)

  });


var geography = d3.select("#geography")
window.addEventListener("load", function(){


  //Build Charts
  //Chart 1
  years = [2010,2011,2012,2013,2014,2015,2016,2017,2018,2019]


  //Define functions to get min and max value of items in a dictionary 
  function getYs(data,value){
    return data.map(d => d[value]);
    }
  function getMinY(data,value){
    return Math.min(...getYs(data,value));
    }
  function getMaxY(data,value){
    return Math.max(...getYs(data,value));
    }

  function makeLineChart(dataset,divs,value){

    console.log(dataset)
    var div = d3.select(divs)


    // 5. X scale will use the index of our data
    var xScale = d3.scaleLinear()
        .domain([2010,2019]) // input
        .range([0, width]); // output

    // 6. Y scale will use the randomly generate number 
    var yScale = d3.scaleLinear()
        .domain([getMinY(dataset,value), getMaxY(dataset,value)]) // input 
        .range([height, 0]); // output 

    // 7. d3's line generator
    var line = d3.line()
        .x(function(d, i) { return xScale(years[i]); }) // set the x values for the line generator
        .y(function(d) { return yScale(d[value]); }) // set the y values for the line generator 
        .curve(d3.curveMonotoneX) // apply smoothing to the line

    // 8. An array of objects of length N. Each object has key -> value pair, the key being "y" and the value is a random number
    //var dataset = d3.range(n).map(function(d) { return {"y": d3.randomUniform(1)() } })

    // 1. Add the SVG to the page and employ #2


    svg = div.append("svg")
        .attr("class","vis")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

    // 3. Call the x axis in a group tag
    svg.append("g")
        .attr("class", "x axis")
        .attr("transform", "translate(0," + height  + ")")
        .call(d3.axisBottom(xScale)
             .tickFormat(d3.format("d"))
             .tickValues([2010,2019]))
        .call(g => g.select(".domain").remove())
        
      
    // Create an axis component with d3.axisBottom

    // 4. Call the y axis in a group tag
    svg.append("g")
        .attr("class", "y axis")
        .call(d3.axisLeft(yScale)
             .tickValues([]))
        .call(g => g.select(".domain").remove()); // Create an axis component with d3.axisLeft

    // 9. Append the path, bind the data, and call the line generator 
    svg.append("path")
        .datum(dataset) // 10. Binds data to the line 
        .attr("class", "line") // Assign a class for styling 
        .attr("d", line); // 11. Calls the line generator 

    // 12. Appends a circle for each datapoint 
    svg.selectAll(".dot")
        .data(dataset)
        .enter().append("circle") // Uses the enter().append() method
        .attr("class", "dot") // Assign a class for styling
        .attr("cx", function(d, i) { return xScale(years[i]) })
        .attr("cy", function(d) { return yScale(d[value]) })
        .attr("r", 5)
        .on("mouseover", function(d,i) {    
                tip      
                    .transition()   
                    .duration(200)
                    .style("opacity", 1);    
                tip .html("<b>"+ years[i] +'</b>: '+ d[value])  
                    .style("left", (d3.event.pageX) + "px")   
                    .style("top", (d3.event.pageY - 28) + "px");  
                })          
        .on("mouseout", function(d) {   
                tip.transition()    
                    .duration(500)   
                    .style("opacity", 0); 
            });
    }
  function makeStackedBarChart(dataset,divs,value,setting){

    if (setting == 1){
      console.log("Update")
    }else{
      console.log("First dibs")
      console.log(setting)
    }
    var keys = Object.keys(dataset[0]).slice(3,19)

    dataset.forEach((d,i) => d['Year'] = years[i])
    dataset = dataset.filter(d => d.Year == '2010' | d.Year == '2019')

    var year   = [...new Set(dataset.map(d => d.state))]
    var states = [...new Set(dataset.map(d => d.Year))]
  
    var div = d3.select(divs)

    svg = div.append("svg")
        .attr("class","vis")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");


    var y = d3.scaleBand()
    .range([margin.top, height - margin.bottom])
    .padding(0.1)
    .paddingOuter(0.2)
    .paddingInner(0.2)

    var x = d3.scaleLinear()
      .range([margin.left, width - margin.right])

    var yAxis = svg.append("g")
      .attr("transform", `translate(${margin.left},0)`)
      .attr("class", "y-axis")

    var xAxis = svg.append("g")
      .attr("transform", `translate(0,${margin.top})`)
      .attr("class", "x-axis")


    var z = d3.scaleOrdinal()
      .range(["steelblue", "darkorange", "lightblue"])
      .domain(keys);

    update(dataset,18, 0)

    function update(dataset,input, speed) {

      var data = dataset.filter(f => f.state == input)

      data.forEach(function(d) {
        d.total = d3.sum(keys, k => +d[k])
        return d
      })

      x.domain([0, d3.max(data, d => d.total)]).nice();

      svg.selectAll(".x-axis").transition().duration(speed)
        .call(d3.axisTop(x).ticks(null, "s").tickValues([]))
        .call(g => g.select(".domain").remove())

      data.sort((a, b) => states.indexOf(a.Year) - states.indexOf(b.Year))

      y.domain(data.map(d => d.Year));

      svg.selectAll(".y-axis").transition().duration(speed)
        .call(d3.axisLeft(y).tickSizeOuter(0))

      var group = svg.selectAll("g.layer")
        .data(d3.stack().keys(keys)(data), d => d.key, (d,i) => i)

      group.exit().remove()

      group.enter().insert("g", ".y-axis").append("g")
      .on("mouseover", function(d,i) {
                console.log(d)    
                tip      
                    .transition()   
                    .duration(200)
                    .style("opacity", 1);    
                tip .html("<b>"+ d.key + '</b>: ' + (d[1][1]-d[1][0]) )  
                    .style("left", (d3.event.pageX) + "px")   
                    .style("top", (d3.event.pageY - 28) + "px");  
                })          
        .on("mouseout", function(d) {   
                tip.transition()    
                    .duration(500)   
                    .style("opacity", 0); 
            })
        .classed("layer", true)
        .attr("fill", d => z(d.key));

      var bars = svg.selectAll("g.layer").selectAll("rect")
        .data(d => d, e => e.data.Year);

      bars.exit().remove()

      function getKeyByValue(object, value) {
        return Object.keys(object).find(key => object[key] === value);
      }

      bars.enter().append("rect")
        .attr("height", y.bandwidth())
        .merge(bars)
        
      .transition().duration(speed)
        .attr("y", d => y(d.data.Year))
        .attr("x", d => x(d[0]))
        .attr("width", d => x(d[1]) - x(d[0]))
        

      /*var text = svg.selectAll(".text")
        .data(data, d => d.Year);

      text.exit().remove()

      text.enter().append("text")
        .attr("class", "text")
        .attr("text-anchor", "start")
        .merge(text)
      .transition().duration(speed)
        .attr("y", d => y(d.Year) + y.bandwidth() / 2)
        .attr("x", d => x(d.total) + 5)
        .text(d => d.total)*/
    }
    }
  charttypes = [makeLineChart,makeLineChart,makeStackedBarChart,makeLineChart,makeLineChart,makeLineChart]
  function assignData(data,variables,charts){
    

      data.forEach(function(d,i){
        d.slice(1,d.length).forEach(function(h,o){
          var dict = new Object();
          d[0].forEach(function(b,l){
            dict[b] = d[o+1][l]
          })
          data[i][o+1] = dict
        })
      })

      var geos = new Object();
      data[0].slice(1,data[0].length).map(function(x){
        geos[x['county']] = []
      })

      years.forEach(function(d,i){
        for (object in geos){
          geos[object].push(data[i].filter(r => r['county'] == object)[0])
        }
      })


      dataset = geos['001']
    
      //For each chart make a chart based on the given variables
      charts.forEach(function(d,i){
        charttypes[i](dataset,d,variables[i])
        //makeLineChart(dataset,d,variables[i])
      })

    function updateGraph(fips,vars,div){
    //Remove existing charts
        d3.selectAll(".vis").remove()
        data = geos[fips]
        charts.forEach(function(d,i){
          charttypes[i](data,d,variables[i],1)
        })
        }

    d3.json("gis/counties.geojson", function(data) {

      //Create a new object reorienting the shapefile using the geography name as the key
      var nest = d3.nest()
      .key(function(d){
        return d.properties.NAMELSAD;
      })
      .entries(data.features)

      //Build Geography Selector Change Logic
      const geographies = document.querySelector('#geography')

      geographies.addEventListener('change', (event) => {

        //Resize box
        option = selectResize('#geography',0)
        
        //Zoom in on map
        index = data.features.findIndex(data => data.properties.NAMELSAD === option)
        bounds = turf.bbox(data.features[index])

        value = data.features[index]

        map.fitBounds([
        bounds.slice(0,2), // southwestern corner of the bounds
        bounds.slice(2,4) // northeastern corner of the bounds
        ]);

        countyfip = value.properties.COUNTYFP
        
        charts = ['#chart1','#chart2','#chart3','#chart4','#chart5','#chart6']
        variables = ["B01001_001E","B17010_003E",["B19001_002E","B19001_003E","B19001_004E","B19001_005E","B19001_006E","B19001_007E","B19001_008E","B19001_009E","B19001_010E","B19001_011E","B19001_012E","B19001_013E","B19001_014E","B19001_015E","B19001_016E","B19001_017E"],"B01001_001E","B01003_001E","B17010_003E"]
        
        //Update Charts
        updateGraph(countyfip,variables,charts)


        });

      //Initial Resize for Geographies
      selectResize('#geography',1)

      geography
      .selectAll("option")
      .data(nest)
      .enter()
      .append("option")
      .attr("value", function(d){
        return d.key;
      })
      .text(function(d){
        return d.key;
      })

      mapboxgl.accessToken = 'pk.eyJ1Ijoia3BjbHluZSIsImEiOiJjanN3MzlpY2EwZGpjM3lsaGNhb3NqY3JmIn0._sGjIhmL5Xt08WIMWRsSsg';
      var map = new mapboxgl.Map({
        container: 'map'
        , style: 'mapbox://styles/mapbox/light-v10'
        , center: [-86.158017, 39.897451]
        , zoom: 5.75
        , pitch: 0
        , bearing: 0
        , maxPitch: 85,
      });   

      map.scrollZoom.disable();

      map.on('load', function () {
        //Add geojson file as data source
        map.addSource('indiana', {
          'type': 'geojson',
          'data':data
          });
        //Add fill layer to map 
        map.addLayer({
          'id': 'indiana',
          'type': 'fill',
          'source': 'indiana',
          'paint': {
            'fill-color': 'rgba(0,55,104,.2)',
          }
        })
        //Add seperate stroke layer
        map.addLayer({
          'id': 'indiana-stroke',
          'type': 'line',
          'source': 'indiana',
          'paint': {
            'line-color': 'rgba(0, 55, 104, 1)',
            'line-width': 4
          }
        })
      })
    })
  }
  
  
  function collectData(fips,variable,div){

    //Concatenate the variables into a comma seperated string for use in the API call
    variables = variable.join()
    
    //Since the API has a seperate endpoint for each year, we need to create an array of promises to pull them all
    fetches = Array()
    years.forEach(year => fetches.push(fetch('https://api.census.gov/data/' + String(year) + '/acs/acs5?get=NAME,'+variables+'&for=county:'+ fips +'&in=state:18&key=dd33b0475c26275920fe5c32a030d1a3310e899f')))

    //When all of the promises have resolved assign the data to their appropriate charts
    Promise.all(fetches)
    .then(function (responses) {
      // Get a JSON object from each of the responses and merge into one object
      return Promise.all(responses.map(function (response) {
        return response.json();
      }));
    })
    .then(function (data) {
      // Assign data
      assignData(data,variable,div)
    })
    .catch(function (error) {
      // if there's an error, log it
      console.log(error);
    });
  }


  //Make Initial Charts

  charts = ['#chart1','#chart2','#chart3','#chart4','#chart5','#chart6']

  //variables = ["B01001_001E","B01003_001E","B17010_003E","B01001_001E","B01003_001E","B17010_003E"]
  variables = ["B01001_001E","B17010_003E",["B19001_002E","B19001_003E","B19001_004E","B19001_005E","B19001_006E","B19001_007E","B19001_008E","B19001_009E","B19001_010E","B19001_011E","B19001_012E","B19001_013E","B19001_014E","B19001_015E","B19001_016E","B19001_017E"],"B01001_001E","B01003_001E","B17010_003E"]
  collectData("*",variables,charts)

  //Define Method to Update Charts - Remove Existing and Replace (Should update to be dynamic)





});



    /////table

    d3.csv("https://docs.google.com/spreadsheets/d/1xOOqJlqbLIsuJdOIRC30UbJjYdQOcf6bKTxqvsMVoQE/gviz/tq?tqx=out:csv&gid=0", function(error, data1) {
      if (error) throw error;
      
      d3.csv("https://docs.google.com/spreadsheets/d/1LMADV7lzfx1rC6AzkrUp8uwe5XuXR8sd3KDeashPmB8/gviz/tq?tqx=out:csv&gid=342967098", function(d){
  return{
    class: d.class,
    businesses: +d.businesses,
    population: +d.population,
    employees: +d.employees
  };
}, function(error, rows) {
      if (error) throw error;

    data = JSON.parse(JSON.stringify(data1)).filter(f => f.geo == 'miami')
    data.forEach(function(v){ delete v.geo });
    
    var columns = d3.keys(data[0]);

    var table = d3.select('#table').append("table");
    var thead = table.append("thead");
    var tbody = table.append("tbody");

     thead.append("tr")
        .selectAll("th")
        .data(columns)
        .enter()
        .append("th")
        .text(function(column) { return column; });

      tbody.selectAll("tr")
        .data(data)
        .enter()
        .append("tr")
        .selectAll("td")
        .data(function(row) {
          return columns.map(function(column) {
            return {
              column: column,
              value: row[column]
            };
          });
        })
        .enter()
        .append("td")
        .text(function(d) { return d.value; })
        .style("color","#000");


  })});
</script>
</html>


